<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="description" content="Examples of openEHR CDS, Guideline and Planning artefacts.">
<meta name="keywords" content="process, task planning, CDS, CPG, decision logic, examples, workflow">
<title>openEHR CDS, Guidelines and Planning Examples</title>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/openehr.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_openehr_cds_guidelines_and_planning_examples">openEHR CDS, Guidelines and Planning Examples</a>
<ul class="sectlevel1">
<li><a href="#_amendment_record">Amendment Record</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_support">Support</a></li>
<li><a href="#_trademarks">Trademarks</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_related_documents">1.2. Related Documents</a></li>
<li><a href="#_status">1.3. Status</a></li>
<li><a href="#_feedback">1.4. Feedback</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_draw_io_tool_mode">2.1. Draw.io Tool mode</a></li>
</ul>
</li>
<li><a href="#_teamwork">3. Teamwork</a>
<ul class="sectlevel2">
<li><a href="#_out_patient_eye_clinic_encounter">3.1. Out-patient Eye Clinic Encounter</a>
<ul class="sectlevel3">
<li><a href="#_plan_overview">3.1.1. Plan Overview</a></li>
<li><a href="#_detailed_description">3.1.2. Detailed Description</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_order_management">4. Order Management</a>
<ul class="sectlevel2">
<li><a href="#_order_coordination">4.1. Order Coordination</a>
<ul class="sectlevel3">
<li><a href="#_plan_overview_2">4.1.1. Plan Overview</a></li>
<li><a href="#_detailed_description_2">4.1.2. Detailed Description</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_multi_drug_chemotherapy">5. Multi-drug Chemotherapy</a>
<ul class="sectlevel2">
<li><a href="#_limitations">5.1. Limitations</a></li>
<li><a href="#_plan_definition">5.2. Plan Definition</a></li>
<li><a href="#_rchops21_decision_logic_module">5.3. RCHOPS21 Decision Logic Module</a></li>
</ul>
</li>
<li><a href="#_antenatal_care">6. Antenatal Care</a>
<ul class="sectlevel2">
<li><a href="#_work_plan">6.1. Work Plan</a></li>
<li><a href="#_pregnancy_risk_assessment_dlm">6.2. Pregnancy Risk Assessment DLM</a></li>
</ul>
</li>
<li><a href="#_breast_cancer_decision_protocol">7. Breast Cancer Decision Protocol</a>
<ul class="sectlevel2">
<li><a href="#_decision_logic_module">7.1. Decision Logic Module</a></li>
</ul>
</li>
<li><a href="#_covid19_severity_classification">8. Covid19 Severity Classification</a>
<ul class="sectlevel2">
<li><a href="#_work_plan_2">8.1. Work Plan</a></li>
<li><a href="#_decision_logic_module_2">8.2. Decision Logic Module</a></li>
</ul>
</li>
<li><a href="#_cha2ds2_vasc">9. CHA2DS2-VASc</a>
<ul class="sectlevel2">
<li><a href="#_work_plan_3">9.1. Work Plan</a></li>
<li><a href="#_decision_logic_module_3">9.2. Decision Logic Module</a></li>
<li><a href="#_bindings">9.3. Bindings</a></li>
</ul>
</li>
<li><a href="#_qrisk3_2017">10. qRisk3-2017</a>
<ul class="sectlevel2">
<li><a href="#_decision_logic_module_4">10.1. Decision Logic Module</a></li>
</ul>
</li>
<li><a href="#_national_early_warning_score_news_2">11. National Early Warning Score (NEWS) 2</a>
<ul class="sectlevel2">
<li><a href="#_work_plan_4">11.1. Work Plan</a></li>
<li><a href="#_decision_logic_module_5">11.2. Decision Logic Module</a></li>
<li><a href="#_bindings_2">11.3. Bindings</a></li>
</ul>
</li>
<li><a href="#_common_decision_logic_modules">12. Common Decision Logic Modules</a>
<ul class="sectlevel2">
<li><a href="#_basic_demographics">12.1. BASIC: Demographics</a></li>
<li><a href="#_bsa_body_surface_area">12.2. BSA: Body Surface Area</a></li>
<li><a href="#_bmi_body_mass_index">12.3. BMI: Body Mass Index</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="https://specifications.openehr.org/images/openEHR_logo_RGB.svg" alt="openEHR logo">
</div>
</div>
</div>
</div>
<h1 id="_openehr_cds_guidelines_and_planning_examples" class="sect0"><a class="anchor" href="#_openehr_cds_guidelines_and_planning_examples"></a>openEHR CDS, Guidelines and Planning Examples</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all fit-content spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="https://www.openehr.org/programs/specification" target="_blank" rel="noopener">openEHR Specification Program</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: PROC latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: DEVELOPMENT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: process, task planning, CDS, CPG, decision logic, examples, workflow</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<object type="image/svg+xml" data="openehr_block_diagram.svg" width="60%"><span class="alt">openEHR components</span></object>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2017 - 2021 The openEHR Foundation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="https://www.openehr.org" target="_blank" rel="noopener">The openEHR Foundation</a> is an independent, non-profit foundation, facilitating the sharing of health records by consumers and clinicians via open specifications, clinical models and open platform implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 3.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/3.0/" class="bare">https://creativecommons.org/licenses/by-nd/3.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://specifications.openehr.org/components/PROC/open_issues" target="_blank" rel="noopener">Problem Reports</a><br>
 Web: <a href="https://specifications.openehr.org" target="_blank" rel="noopener">specifications.openEHR.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_amendment_record"><a class="anchor" href="#_amendment_record"></a>Amendment Record</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>PROC Release 1.5.0</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>PROC Release 1.0.0</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue"></a>0.1.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update perinatal care DLM.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D S Alves</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue_date"></a>18 Nov 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replace 'manual notification' callback by normal Handoff followed by manual notification Task wait state.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M Polajnar,<br>
 T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 Apr 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial writing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale,<br>
 B Næss</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 Apr 2019</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>Contributors</h3>
<div class="ulist">
<ul>
<li>
<p>Danielle S Alves, RN, midwife, Federal University of Pernambuco (UFPE), Brazil</p>
</li>
<li>
<p>Bjørn Næss, DIPS, Norway</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_support"><a class="anchor" href="#_support"></a>Support</h3>
<div class="paragraph">
<p>The work reported in this specification has been funded by the following organisations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DIPS, Norway</p>
</li>
<li>
<p>Marand d.o.o., Slovenia</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trademarks"><a class="anchor" href="#_trademarks"></a>Trademarks</h3>
<div class="ulist">
<ul>
<li>
<p>'openEHR' is a trademark of the openEHR Foundation.</p>
</li>
<li>
<p>'OMG' is a trademark of the Object Management Group.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>This document contains elaborated examples of the openEHR Process framework, including Task Plans and Decision Logic Modules, with diagrams in TP-VML.</p>
</div>
<div class="paragraph">
<p>The intended audience includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plan and Guideline authors;</p>
</li>
<li>
<p>Tool vendors.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_documents"><a class="anchor" href="#_related_documents"></a>1.2. Related Documents</h3>
<div class="paragraph">
<p>Prerequisite documents for reading this document include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/PROC/latest/task_planning.html" target="_blank" rel="noopener">openEHR Task Planning Model</a>;</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/PROC/latest/decision_language.html" target="_blank" rel="noopener">openEHR Decision Language</a>;</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/PROC/latest/tp_vml.html" target="_blank" rel="noopener">openEHR Task Planning Visual Modelling Language (TP-VML)</a>;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.3. Status</h3>
<div class="paragraph">
<p>This specification is in the DEVELOPMENT state. The development version of this document can be found at <a href="https://specifications.openehr.org/releases/PROC/latest/process_examples.html" target="_blank" rel="noopener">https://specifications.openehr.org/releases/PROC/latest/process_examples.html</a>.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.4. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="https://discourse.openehr.org/c/specifications/task-planning-gdl" target="_blank" rel="noopener">process specifications forum</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://specifications.openehr.org/components/PROC/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://specifications.openehr.org/components/PROC/history" target="_blank" rel="noopener">PROC component Change Request tracker</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_draw_io_tool_mode"><a class="anchor" href="#_draw_io_tool_mode"></a>2.1. Draw.io Tool mode</h3>
<div class="paragraph">
<p>The following files can be downloaded and then imported into draw.io as libraries to provide a working palette for TP-VML diagrams.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="process_examples/draw.io-lib/TP_VML_plans.xml">TP_VML plans</a></p>
</li>
<li>
<p><a href="process_examples/draw.io-lib/TP_VML_groups.xml">TP_VML groups</a></p>
</li>
<li>
<p><a href="process_examples/draw.io-lib/TP_VML_tasks.xml">TP_VML tasks</a></p>
</li>
<li>
<p><a href="process_examples/draw.io-lib/TP_VML_events.xml">TP_VML events</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_teamwork"><a class="anchor" href="#_teamwork"></a>3. Teamwork</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The examples in this section illustrate the use of TP for team-based work plans, including hand-offs, callbacks and other kinds of coordination.</p>
</div>
<div class="sect2">
<h3 id="_out_patient_eye_clinic_encounter"><a class="anchor" href="#_out_patient_eye_clinic_encounter"></a>3.1. Out-patient Eye Clinic Encounter</h3>
<div class="paragraph">
<p>This example is based on the original description of <a href="https://github.com/bjornna/TP-examples/blob/master/16-eye_outpatient/index.adoc">DIPS Eye encounter example</a>.</p>
</div>
<div id="outpatient_eye_clinic" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/diagrams/outpatient_eye_clinic.svg" alt="outpatient eye clinic">
</div>
<div class="title">Figure 1. Outpatient eye clinic encounter</div>
</div>
<div class="sect3">
<h4 id="_plan_overview"><a class="anchor" href="#_plan_overview"></a>3.1.1. Plan Overview</h4>
<div class="paragraph">
<p>As for all Plans defined in the Task Planning formalism, it must be remembered that the Plan definition above is what the <em>TP engine executes</em>. It is the result of the execution (including worker allocation and communication, which is not shown in the definition) that causes workers in the real world to do things. Additionally, what the TP engine knows about the real world is limited to what it is told - many actions and events can occur outside the TP computing environment that will remain unknown to the system unless it is informed (e.g. by Manual notification).</p>
</div>
<div class="paragraph">
<p>The Work Plan consists of two top-level Task Plans, one for the patient and one for the clinic administrator / reception. The latter has two sub-plans linked by hand-off Tasks.</p>
</div>
<div class="paragraph">
<p>The purpose of the patient top-level Task Plan is to allow the system to notify the patient of the visit, via a reminder on the day of the visit, or some fixed time beforehand. The driving event is the calendar appointment, which is waited on by both the patient and the clinic admin Task Plans. It is assumed that longer term reminders, opportunities for changing appointments and so on are managed by another system that see the same calendar events, and is responsible for setting the calendar events in the first place. Thus, in the model above, the patient top-level plan is not really necessary (he/she will be notified by the appointment system), and is mainly included for purposes of demonstration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_detailed_description"><a class="anchor" href="#_detailed_description"></a>3.1.2. Detailed Description</h4>
<div class="paragraph">
<p>The main work of the Work Plan is in the other three Task Plans, which essentially encode the following logic:</p>
</div>
<div class="paragraph">
<p>Clinic Administrator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>clinic has a live Task Plan waiting on appointment A for patient P, at 2019-02-15 09:30:00;</p>
</li>
<li>
<p>when this calendar timepoint is reached, the TP system 'opens' the appointment via a System Request to the clinic appointment system (details not shown);</p>
</li>
<li>
<p>WAIT: the clinic Task Plan enters a new wait state for patient P, for appointment A;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Patient:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>patient arrives at clinic (modelled as a Manual notification);</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clinic Administrator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>receive patient, record presence;</p>
</li>
<li>
<p>Hand-off: pass to consultation (e.g. send to waiting area);</p>
</li>
<li>
<p>WAIT: until manual notification (patient returns)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nurse:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>receive patient &amp; check EMR</p>
</li>
<li>
<p>review eye function, decide on whether to send to doc or not:</p>
<div class="ulist">
<ul>
<li>
<p>EITHER: return to reception</p>
</li>
<li>
<p>OR: pass to doctor</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Specialist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>receive patient and check EMR</p>
</li>
<li>
<p>perform examination</p>
</li>
<li>
<p>update EMR</p>
</li>
<li>
<p>send patient back to reception.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_order_management"><a class="anchor" href="#_order_management"></a>4. Order Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The examples in this section illustrate the use of TP for order management, where openEHR Instructions and Actions (or other non-openEHR equivalents) are created and tracked.</p>
</div>
<div class="sect2">
<h3 id="_order_coordination"><a class="anchor" href="#_order_coordination"></a>4.1. Order Coordination</h3>
<div class="paragraph">
<p>This example is based on a standard Moscow City clinic protocol, and covers a 12 month period.</p>
</div>
<div id="order_coordination" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/diagrams/order_coordination.svg" alt="order coordination">
</div>
<div class="title">Figure 2. GP order coordination</div>
</div>
<div class="sect3">
<h4 id="_plan_overview_2"><a class="anchor" href="#_plan_overview_2"></a>4.1.1. Plan Overview</h4>
<div class="paragraph">
<p>The Work Plan shown above defines the tasks for a 'standard health check' that includes a chest x-ray, a full blood panel and a hypertension checkup. The Plan executes over the periof a year, and consists of a health coordinator creating orders for the three items, via UI forms. The result of creating these orders will be the creation of a normal Composition and Instruction in the openEHR EHR for the patient. At some later point in time, the coordinator will action these orders, which will cause the EHR data to be used to create appropriate API calls / messages to the relevant target systems (radiology clinic, pathology lab, consultant) that will further cause appointments and attendances in the normal way by the patient. Each of these 'execute order' Tasks will block and wait for appropriate callbacks resulting from each of the orders being fulfilled and corresponding Actions being committed to the EHR (or else timeouts, if nothing happens). With the received results, the coordinator creates a health summary for the patient and commits that to the EHR.</p>
</div>
</div>
<div class="sect3">
<h4 id="_detailed_description_2"><a class="anchor" href="#_detailed_description_2"></a>4.1.2. Detailed Description</h4>
<div class="paragraph">
<p>TBD</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multi_drug_chemotherapy"><a class="anchor" href="#_multi_drug_chemotherapy"></a>5. Multi-drug Chemotherapy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section illustrates multi-drug chemotherapy with complex dosing and timing arrangements.</p>
</div>
<div class="paragraph">
<p>This example is based on the version of RCHOPS-21 documented by <a href="http://nssg.oxford-haematology.org.uk/lymphoma/documents/lymphoma-chemo-protocols/L-80-r-chop-21.pdf">NHS Thames Valley Cancer Network</a>.</p>
</div>
<div class="sect2">
<h3 id="_limitations"><a class="anchor" href="#_limitations"></a>5.1. Limitations</h3>
<div class="paragraph">
<p>The following elements of the plan are not yet included (mainly for brevity of the example):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vincristine dose modification due to hepatic impairment;</p>
</li>
<li>
<p>Concurrent meds only shown in summarised form;</p>
</li>
<li>
<p>Exception pathways to handle patient reactions not shown.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_plan_definition"><a class="anchor" href="#_plan_definition"></a>5.2. Plan Definition</h3>
<div class="paragraph">
<p>The following shows the pre-medication phase.</p>
</div>
<div id="rchops_pre" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/diagrams/RCHOPS21-pre.svg" alt="RCHOPS21 pre">
</div>
<div class="title">Figure 3. RCHOPS21 pre-med phase</div>
</div>
<div class="paragraph">
<p>The following shows the main regime, including conditional addition of Rituximab / methotrexate for high IPI patients.</p>
</div>
<div id="rchops_admin" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/diagrams/RCHOPS21-admin.svg" alt="RCHOPS21 admin">
</div>
<div class="title">Figure 4. RCHOPS21 administration phase</div>
</div>
</div>
<div class="sect2">
<h3 id="_rchops21_decision_logic_module"><a class="anchor" href="#_rchops21_decision_logic_module"></a>5.3. RCHOPS21 Decision Logic Module</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">RCHOPS21</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
        <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Thomas Beale&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;thomas.beale@openEHR.org&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">organisation</span><span class="tok-o">:</span>   <span class="tok-s2">&quot;openEHR Foundation &lt;http://www.openEHR.org&gt;&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">date</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;2021-01-10&quot;</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">details</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                <span class="tok-nx">purpose</span><span class="tok-o">:</span> <span class="tok-s2">&quot;NHS CHOPS-21 chemotherapy guideline ....&quot;</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span>

<span class="tok-nx">use</span>
    <span class="tok-nx">BSA</span>: <span class="tok-kt">Body_surface_area.v0.5.0</span>

<span class="tok-nx">preconditions</span>
    <span class="tok-nx">has_lymphoma_diagnosis</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Reference</span>

    <span class="tok-nx">paracetamol_dose</span>: <span class="tok-kt">Quantity</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-nx">g</span><span class="tok-p">;</span>
    <span class="tok-nx">chlorphenamine_dose</span>: <span class="tok-kt">Quantity</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-nx">mg</span><span class="tok-p">;</span>
    <span class="tok-nx">prednisolone_dose_per_m2</span>: <span class="tok-kt">Quantity</span> <span class="tok-o">=</span> <span class="tok-mi">40</span><span class="tok-nx">mg</span><span class="tok-p">;</span>
    <span class="tok-nx">rituximab_dose_per_m2</span>: <span class="tok-kt">Quantity</span> <span class="tok-o">=</span> <span class="tok-mi">375</span><span class="tok-nx">mg</span><span class="tok-p">;</span>
    <span class="tok-nx">doxorubicin_dose_per_m2</span>: <span class="tok-kt">Quantity</span> <span class="tok-o">=</span> <span class="tok-mi">50</span><span class="tok-nx">mg</span><span class="tok-p">;</span>
    <span class="tok-nx">vincristine_dose_per_m2</span>: <span class="tok-kt">Quantity</span> <span class="tok-o">=</span> <span class="tok-mf">1.4</span><span class="tok-nx">mg</span><span class="tok-p">;</span>
    <span class="tok-nx">cyclophosphamide_dose_per_m2</span>: <span class="tok-kt">Quantity</span> <span class="tok-o">=</span> <span class="tok-mi">750</span><span class="tok-nx">mg</span><span class="tok-p">;</span>
    <span class="tok-nx">cycle_period</span>: <span class="tok-kt">Duration</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-nx">w</span><span class="tok-p">;</span>
    <span class="tok-nx">cycle_repeats</span>: <span class="tok-kt">Integer</span> <span class="tok-o">=</span> <span class="tok-mi">6</span><span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">State</span>

    <span class="tok-nx">has_lymphoma_diagnosis</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-nx">time_window</span> <span class="tok-o">=</span> <span class="tok-nx">tw_current_episode</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Tracked</span> <span class="tok-nx">state</span>

    <span class="tok-nx">staging</span>: <span class="tok-kt">Terminology_term</span> <span class="tok-err">«</span><span class="tok-nx">ann_arbor_staging</span><span class="tok-err">»</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">30</span> <span class="tok-nx">days</span>
        <span class="tok-nx">time_window</span> <span class="tok-o">=</span> <span class="tok-nx">tw_current_episode</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_metastases</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">30</span> <span class="tok-nx">days</span>
        <span class="tok-nx">time_window</span> <span class="tok-o">=</span> <span class="tok-nx">tw_current_episode</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Neutrophils</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">neutrophils</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-nx">d</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;/L&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">--------------------------------</span>
            <span class="tok-o">|&gt;</span><span class="tok-mi">1</span> <span class="tok-nx">x</span> <span class="tok-mi">10</span><span class="tok-o">^</span><span class="tok-mi">9</span><span class="tok-o">|:</span>          <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mf">0.5</span> <span class="tok-o">-</span> <span class="tok-mi">1</span> <span class="tok-nx">x</span> <span class="tok-mi">10</span><span class="tok-o">^</span><span class="tok-mi">9</span><span class="tok-o">|:</span>     <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">],</span>
            <span class="tok-o">|&lt;</span><span class="tok-mf">0.5</span> <span class="tok-nx">x</span> <span class="tok-mi">10</span><span class="tok-o">^</span><span class="tok-mi">9</span><span class="tok-o">|:</span>        <span class="tok-p">[</span><span class="tok-nx">very_low</span><span class="tok-p">]</span>
            <span class="tok-o">--------------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Platelets</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">platelets</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">12</span><span class="tok-nx">h</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;/L&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">------------------------------</span>
            <span class="tok-o">|&gt;</span><span class="tok-mi">75</span> <span class="tok-nx">x</span> <span class="tok-mi">10</span><span class="tok-o">^</span><span class="tok-mi">9</span><span class="tok-o">|:</span>       <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">50</span> <span class="tok-o">-</span> <span class="tok-mi">74</span> <span class="tok-nx">x</span> <span class="tok-mi">10</span><span class="tok-o">^</span><span class="tok-mi">9</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">],</span>
            <span class="tok-o">|&lt;</span><span class="tok-mi">50</span> <span class="tok-nx">x</span> <span class="tok-mi">10</span><span class="tok-o">^</span><span class="tok-mi">9</span><span class="tok-o">|:</span>       <span class="tok-p">[</span><span class="tok-nx">very_low</span><span class="tok-p">]</span>
            <span class="tok-o">------------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Bilirubins</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">bilirubin</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">12</span><span class="tok-nx">h</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;mmol/L&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">----------------------------</span>
            <span class="tok-o">|&lt;</span><span class="tok-mi">20</span><span class="tok-o">|:</span>          <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">20</span> <span class="tok-o">-</span> <span class="tok-mi">51</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">high</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">51</span> <span class="tok-o">-</span> <span class="tok-mi">85</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">very_high</span><span class="tok-p">],</span>
            <span class="tok-o">|&gt;</span><span class="tok-mi">85</span><span class="tok-o">|:</span>          <span class="tok-p">[</span><span class="tok-nx">crit_high</span><span class="tok-p">]</span>
            <span class="tok-o">---------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Glomerular</span> <span class="tok-nx">filtration</span> <span class="tok-nx">rate</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">gfr</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">24</span><span class="tok-nx">h</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;mL/min&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">----------------------</span>
            <span class="tok-o">|&gt;</span><span class="tok-mi">20</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">10</span> <span class="tok-o">-</span> <span class="tok-mi">20</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">],</span>
            <span class="tok-o">|&lt;</span><span class="tok-mi">10</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">very_low</span><span class="tok-p">]</span>
            <span class="tok-o">----------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Lactate</span> <span class="tok-nx">dehydrogenase</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">ldh</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">24</span><span class="tok-nx">h</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;mL/min&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">--------------------------</span>
            <span class="tok-o">|&gt;</span><span class="tok-mi">20</span> <span class="tok-o">|:</span>         <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">10</span> <span class="tok-o">-</span> <span class="tok-mi">20</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">],</span>
            <span class="tok-o">|&lt;</span><span class="tok-mi">10</span><span class="tok-o">|:</span>          <span class="tok-p">[</span><span class="tok-nx">very_low</span><span class="tok-p">]</span>
            <span class="tok-o">--------------------------</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Conditions</span>

    <span class="tok-nx">high_ipi</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">ipi_risk</span> <span class="tok-err">∈</span> <span class="tok-p">{[</span><span class="tok-nx">ipi_high_risk</span><span class="tok-p">],</span> <span class="tok-p">[</span><span class="tok-nx">ipi_intermediate_high_risk</span><span class="tok-p">]}</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">patient</span> <span class="tok-nx">fit</span> <span class="tok-nx">to</span> <span class="tok-nx">undertake</span> <span class="tok-nx">regime</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">patient_fit</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">not</span>
            <span class="tok-p">(</span><span class="tok-nx">platelets</span><span class="tok-p">.</span><span class="tok-nx">in_range</span> <span class="tok-p">([</span><span class="tok-nx">very_low</span><span class="tok-p">])</span> <span class="tok-nx">or</span>
             <span class="tok-nx">neutrophils</span><span class="tok-p">.</span><span class="tok-nx">in_range</span> <span class="tok-p">([</span><span class="tok-nx">very_low</span><span class="tok-p">]))</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">prednisolone_dose</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">prednisolone_dose_per_m2</span> <span class="tok-o">*</span> <span class="tok-nx">BSA</span><span class="tok-p">.</span><span class="tok-nx">bsa_m2</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">rituximab_dose</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">rituximab_dose_per_m2</span> <span class="tok-o">*</span> <span class="tok-nx">BSA</span><span class="tok-p">.</span><span class="tok-nx">bsa_m2</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">doxorubicin_dose</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">doxorubicin_dose_per_m2</span> <span class="tok-o">*</span> <span class="tok-nx">BSA</span><span class="tok-p">.</span><span class="tok-nx">bsa_m2</span>
            <span class="tok-o">*</span> <span class="tok-k">case</span> <span class="tok-nx">bilirubin</span><span class="tok-p">.</span><span class="tok-nx">range</span> <span class="tok-k">in</span>
                <span class="tok-o">====================</span>
                <span class="tok-p">[</span><span class="tok-nx">high</span><span class="tok-p">]</span><span class="tok-o">:</span>        <span class="tok-mf">0.5</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">very_high</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.25</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">crit_high</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.0</span>
                <span class="tok-o">====================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">TODO</span>: <span class="tok-kt">hepatic</span> <span class="tok-nx">impairment</span> <span class="tok-nx">dose</span> <span class="tok-nx">modification</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">vincristine_dose</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">vincristine_dose_per_m2</span> <span class="tok-o">*</span> <span class="tok-nx">BSA</span><span class="tok-p">.</span><span class="tok-nx">bsa_m2</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">CHECK</span>: <span class="tok-kt">is</span> <span class="tok-nx">low</span> <span class="tok-nx">platelets</span> <span class="tok-nx">and</span> <span class="tok-nx">GFR</span> <span class="tok-nx">dose</span> <span class="tok-nx">modification</span>
    <span class="tok-o">|</span> <span class="tok-nx">cumulative</span><span class="tok-o">?</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">cyclophosphamide_dose</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">cyclophosphamide_dose_per_m2</span> <span class="tok-o">*</span> <span class="tok-nx">BSA</span><span class="tok-p">.</span><span class="tok-nx">bsa_m2</span>
            <span class="tok-o">*</span> <span class="tok-k">case</span> <span class="tok-nx">platelets</span><span class="tok-p">.</span><span class="tok-nx">range</span> <span class="tok-k">in</span>
                <span class="tok-o">===================</span>
                <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">]</span><span class="tok-o">:</span>      <span class="tok-mi">1</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-mf">0.75</span>
                <span class="tok-o">===================</span>
                <span class="tok-p">;</span>
            <span class="tok-o">*</span> <span class="tok-k">case</span> <span class="tok-nx">gfr</span><span class="tok-p">.</span><span class="tok-nx">range</span> <span class="tok-k">in</span>
                <span class="tok-o">===================</span>
                <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">]</span><span class="tok-o">:</span>      <span class="tok-mi">1</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-mf">0.75</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">very_low</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.5</span>
                <span class="tok-o">===================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">International</span> <span class="tok-nx">Prognostic</span> <span class="tok-nx">Index</span>
    <span class="tok-o">|</span> <span class="tok-nx">ref</span>: <span class="tok-kt">https</span><span class="tok-o">:|</span><span class="tok-nx">en</span><span class="tok-p">.</span><span class="tok-nx">wikipedia</span><span class="tok-p">.</span><span class="tok-nx">org</span><span class="tok-o">/</span><span class="tok-nx">wiki</span><span class="tok-o">/</span><span class="tok-nx">International_Prognostic_Index</span>
    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">One</span> <span class="tok-nx">point</span> <span class="tok-nx">is</span> <span class="tok-nx">assigned</span> <span class="tok-k">for</span> <span class="tok-nx">each</span> <span class="tok-nx">of</span> <span class="tok-nx">the</span> <span class="tok-nx">following</span> <span class="tok-nx">risk</span> <span class="tok-nx">factors</span><span class="tok-o">:</span>
    <span class="tok-o">|</span>     <span class="tok-nx">Age</span> <span class="tok-nx">greater</span> <span class="tok-nx">than</span> <span class="tok-mi">60</span> <span class="tok-nx">years</span>
    <span class="tok-o">|</span>     <span class="tok-nx">Stage</span> <span class="tok-nx">III</span> <span class="tok-nx">or</span> <span class="tok-nx">IV</span> <span class="tok-nx">disease</span>
    <span class="tok-o">|</span>     <span class="tok-nx">Elevated</span> <span class="tok-nx">serum</span> <span class="tok-nx">LDH</span>
    <span class="tok-o">|</span>     <span class="tok-nx">ECOG</span><span class="tok-o">/</span><span class="tok-nx">Zubrod</span> <span class="tok-nx">performance</span> <span class="tok-nx">status</span> <span class="tok-nx">of</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-nx">or</span> <span class="tok-mi">4</span>
    <span class="tok-o">|</span>     <span class="tok-nx">More</span> <span class="tok-nx">than</span> <span class="tok-mi">1</span> <span class="tok-nx">extranodal</span> <span class="tok-nx">site</span>
    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">The</span> <span class="tok-nx">sum</span> <span class="tok-nx">of</span> <span class="tok-nx">the</span> <span class="tok-nx">points</span> <span class="tok-nx">allotted</span> <span class="tok-nx">correlates</span> <span class="tok-kd">with</span> <span class="tok-nx">the</span> <span class="tok-nx">following</span> <span class="tok-nx">risk</span> <span class="tok-nx">groups</span><span class="tok-o">:</span>
    <span class="tok-o">|</span>     <span class="tok-nx">Low</span> <span class="tok-nx">risk</span> <span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-o">-</span><span class="tok-mi">1</span> <span class="tok-nx">points</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">-</span><span class="tok-nx">year</span> <span class="tok-nx">survival</span> <span class="tok-nx">of</span> <span class="tok-mi">73</span><span class="tok-o">%</span>
    <span class="tok-o">|</span>     <span class="tok-nx">Low</span><span class="tok-o">-</span><span class="tok-nx">intermediate</span> <span class="tok-nx">risk</span> <span class="tok-p">(</span><span class="tok-mi">2</span> <span class="tok-nx">points</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">-</span><span class="tok-nx">year</span> <span class="tok-nx">survival</span> <span class="tok-nx">of</span> <span class="tok-mi">51</span><span class="tok-o">%</span>
    <span class="tok-o">|</span>     <span class="tok-nx">High</span><span class="tok-o">-</span><span class="tok-nx">intermediate</span> <span class="tok-nx">risk</span> <span class="tok-p">(</span><span class="tok-mi">3</span> <span class="tok-nx">points</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">-</span><span class="tok-nx">year</span> <span class="tok-nx">survival</span> <span class="tok-nx">of</span> <span class="tok-mi">43</span><span class="tok-o">%</span>
    <span class="tok-o">|</span>     <span class="tok-nx">High</span> <span class="tok-nx">risk</span> <span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-o">-</span><span class="tok-mi">5</span> <span class="tok-nx">points</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">-</span><span class="tok-nx">year</span> <span class="tok-nx">survival</span> <span class="tok-nx">of</span> <span class="tok-mi">26</span><span class="tok-o">%</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">ipi_raw_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span><span class="tok-p">.</span><span class="tok-nx">add</span> <span class="tok-p">(</span>
            <span class="tok-o">---------------------------------------------</span>
            <span class="tok-nx">age</span> <span class="tok-o">&gt;</span> <span class="tok-mi">60</span>                             <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">staging</span> <span class="tok-err">∈</span> <span class="tok-p">{[</span><span class="tok-nx">stage_III</span><span class="tok-p">],</span> <span class="tok-p">[</span><span class="tok-nx">stage_IV</span><span class="tok-p">]}</span> <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">ldh</span><span class="tok-p">.</span><span class="tok-nx">in_range</span> <span class="tok-p">([</span><span class="tok-nx">normal</span><span class="tok-p">])</span>              <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">ecog</span> <span class="tok-o">&gt;</span> <span class="tok-mi">1</span>                             <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">extranodal_sites</span> <span class="tok-o">&gt;</span> <span class="tok-mi">1</span>                 <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span>
            <span class="tok-o">---------------------------------------------</span>
        <span class="tok-p">)</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">ipi_risk</span>: <span class="tok-kt">Terminology_code</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span>
            <span class="tok-k">case</span> <span class="tok-nx">ipi_raw_score</span> <span class="tok-k">in</span>
                <span class="tok-o">=======================================</span>
                <span class="tok-o">|</span><span class="tok-mi">0</span><span class="tok-p">..</span><span class="tok-mi">1</span><span class="tok-o">|</span>  <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ipi_low_risk</span><span class="tok-p">],</span>
                <span class="tok-o">|</span><span class="tok-mi">2</span><span class="tok-o">|</span>     <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ipi_intermediate_low_risk</span><span class="tok-p">],</span>
                <span class="tok-o">|</span><span class="tok-mi">3</span><span class="tok-o">|</span>     <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ipi_intermediate_high_risk</span><span class="tok-p">],</span>
                <span class="tok-o">|</span><span class="tok-mi">4</span><span class="tok-p">..</span><span class="tok-mi">5</span><span class="tok-o">|</span>  <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ipi_high_risk</span><span class="tok-p">];</span>
                <span class="tok-o">=======================================</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;paracetamol_dose&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;paracetamol dose&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;paracetamol base dose level per sq. m of BSA&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;chlorphenamine_dose&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;chlorphenamine dose&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;chlorphenamine base dose level per sq. m of BSA&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;staging&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Cancer staging&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Cancer staging (Ann Arbor system)&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;has_metastases&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Metastatic status&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Status of metastasis of cancer&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;neutrophils&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;neutrophils&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;neutrophils level&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;platelets&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;platelets&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;platelets level&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;ipi_low_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;low risk: 5y survival - 73%&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;..&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;ipi_intermediate_low_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;intermediate-low risk: 5y survival - 51%&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;..&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;ipi_intermediate_high_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;intermediate-high risk: 5y survival - 43%&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;ipi_high_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;high risk: 5y survival - 26%&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_antenatal_care"><a class="anchor" href="#_antenatal_care"></a>6. Antenatal Care</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following pregnancy care DLM was developed by Danielle S Alves (RN, midwife) as part of her PhD thesis at Federal University of Pernambuco (UFPE), Brazil.</p>
</div>
<div class="sect2">
<h3 id="_work_plan"><a class="anchor" href="#_work_plan"></a>6.1. Work Plan</h3>
<div class="paragraph">
<p>The following Work Plan is the standard risk assessment for an antenatal visit.</p>
</div>
<div id="prenatal_risk_assessment" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/diagrams/prenatal_risk_assessment2.svg" alt="prenatal risk assessment2">
</div>
<div class="title">Figure 5. Pre-natal risk assessment Work Plan</div>
</div>
</div>
<div class="sect2">
<h3 id="_pregnancy_risk_assessment_dlm"><a class="anchor" href="#_pregnancy_risk_assessment_dlm"></a>6.2. Pregnancy Risk Assessment DLM</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">ruleset</span> <span class="tok-nx">pregnancy_risk_assessment</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Danielle Santos Alves&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;dsa3@cin.ufpe.br&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">organisation</span> <span class="tok-o">:</span>  <span class="tok-s2">&quot;Universidade Federal de Pernambuco&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">date</span>:           <span class="tok-kt">2020</span><span class="tok-o">-</span><span class="tok-mi">12</span><span class="tok-o">-</span><span class="tok-mi">02</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">details</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                    <span class="tok-nx">purpose</span><span class="tok-o">:</span>  <span class="tok-s2">&quot;Rules representing the risks during pregnancy.&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">copyright</span><span class="tok-o">:</span> <span class="tok-s2">&quot;© 2020 Danielle Santos Alves&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">licence</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Creative Commons CC-BY &lt;https://creativecommons.org/licenses/by/3.0/&gt;&quot;</span><span class="tok-p">,</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

<span class="tok-nx">preconditions</span>

    <span class="tok-nx">is_pregnant</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Types</span>

    <span class="tok-nx">Risk_type</span> <span class="tok-o">::=</span> <span class="tok-nx">Ordinal</span>
        <span class="tok-nx">map</span> <span class="tok-o">=</span>
            <span class="tok-o">-------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">emergency</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mi">2</span><span class="tok-p">,</span>
            <span class="tok-p">[</span><span class="tok-nx">high_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-mi">0</span>
            <span class="tok-o">-------------------</span>
        <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Historical</span> <span class="tok-nx">state</span>

    <span class="tok-nx">is_type1_diabetic</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">previous_obstetric_hypertension</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">previous_pre_eclampsia</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">previous_eclampsia</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">previous_gestational_diabetes</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">family_history_of_diabetes</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">race_related_diabetes_risk</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Macrosomic</span> <span class="tok-nx">baby</span> <span class="tok-nx">from</span> <span class="tok-nx">any</span> <span class="tok-nx">previous</span> <span class="tok-nx">pregnancy</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">previous_macrosomic_baby</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">is_pregnant</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_gestational_diabetes</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_pregnancy_hypertension</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_pre_eclampsia</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_eclampsia</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_anaemia_of_pregnancy</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Tracked</span> <span class="tok-nx">State</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Possible</span> <span class="tok-nx">values</span><span class="tok-o">:</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">premature</span> <span class="tok-nx">rupture</span><span class="tok-p">],</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">polyhydramnios</span><span class="tok-p">],</span> <span class="tok-p">[</span><span class="tok-nx">oligohydramnios</span><span class="tok-p">],</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">severe</span> <span class="tok-nx">polyhydramnios</span><span class="tok-p">],</span> <span class="tok-p">[</span><span class="tok-nx">severe</span> <span class="tok-nx">oligohydramnios</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">amniotic_fluid_state</span>: <span class="tok-kt">Terminology_term</span> <span class="tok-err">«</span><span class="tok-nx">amniotic_fluid_state</span><span class="tok-err">»</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">24</span><span class="tok-nx">h</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">uterine_fundal_height</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">24</span><span class="tok-nx">h</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">vaginal_blood_flow</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">30</span><span class="tok-nx">mins</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;mL/hr&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">---------------------------</span>
            <span class="tok-o">|&gt;</span> <span class="tok-mi">500</span><span class="tok-o">|:</span>    <span class="tok-p">[</span><span class="tok-nx">critical_high</span><span class="tok-p">]</span>
            <span class="tok-o">---------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Assessment</span> <span class="tok-nx">of</span> <span class="tok-nx">vaginal</span> <span class="tok-nx">bleeding</span><span class="tok-p">,</span> <span class="tok-nx">pain</span><span class="tok-p">,</span> <span class="tok-nx">confirm</span>
    <span class="tok-o">|</span> <span class="tok-kd">with</span> <span class="tok-nx">ultrasound</span><span class="tok-p">.</span> <span class="tok-nx">Result</span> <span class="tok-nx">value</span><span class="tok-o">-</span><span class="tok-nx">set</span> <span class="tok-nx">includes</span>
    <span class="tok-o">|</span> <span class="tok-o">|</span><span class="tok-nx">placenta</span> <span class="tok-nx">previa</span><span class="tok-o">|</span><span class="tok-p">,</span> <span class="tok-o">|</span><span class="tok-nx">risk</span> <span class="tok-nx">of</span> <span class="tok-nx">miscarriage</span><span class="tok-o">|</span><span class="tok-p">,</span>
    <span class="tok-o">|</span> <span class="tok-o">|</span><span class="tok-nx">ectopic</span> <span class="tok-nx">pregnancy</span><span class="tok-o">|</span> <span class="tok-nx">etc</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">vaginal_physical_exam_assessment</span>: <span class="tok-kt">Terminology_term</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">48</span><span class="tok-nx">h</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">vomiting_assessment</span>: <span class="tok-kt">Terminology_term</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">48</span><span class="tok-nx">h</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">ultrasound_finding</span>: <span class="tok-kt">Terminology_term</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">48</span><span class="tok-nx">h</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Amniotic</span> <span class="tok-nx">fluid</span> <span class="tok-nx">index</span> <span class="tok-p">(</span><span class="tok-nx">cm</span><span class="tok-p">)</span> <span class="tok-nx">via</span> <span class="tok-mi">4</span><span class="tok-o">-</span><span class="tok-nx">quadrant</span> <span class="tok-nx">method</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">amniotic_fluid_index</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">24</span><span class="tok-nx">h</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;cm&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">------------------------------------</span>
            <span class="tok-o">|&gt;</span> <span class="tok-mi">14</span><span class="tok-o">|:</span>            <span class="tok-p">[</span><span class="tok-nx">polyhydramnios</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span> <span class="tok-mi">5</span> <span class="tok-p">..</span> <span class="tok-err">≤</span> <span class="tok-mi">14</span><span class="tok-o">|:</span>     <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">|&lt;</span> <span class="tok-mi">5</span><span class="tok-o">|:</span>             <span class="tok-p">[</span><span class="tok-nx">oligohydramnios</span><span class="tok-p">]</span>
            <span class="tok-o">------------------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">labour_onset_assessment</span>: <span class="tok-kt">Terminology_term</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">24</span><span class="tok-nx">h</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Convert</span> <span class="tok-nx">BMI</span> <span class="tok-nx">to</span> <span class="tok-nx">ranges</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">bmi_range</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">COMMON</span><span class="tok-p">.</span><span class="tok-nx">simple_ranges</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">BMI</span><span class="tok-p">.</span><span class="tok-nx">BMI</span> <span class="tok-k">in</span>
            <span class="tok-o">===========================</span>
            <span class="tok-o">|&gt;</span> <span class="tok-mi">30</span><span class="tok-o">|:</span>           <span class="tok-p">[</span><span class="tok-nx">high</span><span class="tok-p">],</span>
            <span class="tok-o">---------------------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span> <span class="tok-mi">15</span> <span class="tok-p">..</span> <span class="tok-err">≤</span> <span class="tok-mi">30</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">---------------------------</span>
            <span class="tok-o">|&lt;</span> <span class="tok-mi">15</span><span class="tok-o">|:</span>           <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">]</span>
            <span class="tok-o">===========================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Possible</span> <span class="tok-nx">values</span><span class="tok-o">:</span>
    <span class="tok-o">|</span>    <span class="tok-o">|</span><span class="tok-nx">excluded</span><span class="tok-o">|</span><span class="tok-p">,</span> <span class="tok-o">|</span><span class="tok-nx">anaemia</span> <span class="tok-nx">of</span> <span class="tok-nx">pregnancy</span><span class="tok-o">|</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">anaemia_type</span>: <span class="tok-kt">Terminology_term</span> <span class="tok-err">«</span><span class="tok-nx">anaemia_type</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">not</span> <span class="tok-nx">has_anaemia_of_pregnancy</span> <span class="tok-o">?</span> <span class="tok-p">[</span><span class="tok-nx">excluded</span><span class="tok-p">]</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">anaemia_of_pregnancy</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">ultrasound_required</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">fundal_height_related_risk</span> <span class="tok-o">!=</span> <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span> <span class="tok-nx">or</span>
                <span class="tok-nx">amniotic_fluid_risk</span> <span class="tok-o">!=</span> <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span> <span class="tok-nx">or</span>
                <span class="tok-nx">vaginal_bleeding_related_risk</span> <span class="tok-o">!=</span> <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">anaemia_risk</span>: <span class="tok-kt">Risk_type</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">anaemia_type</span> <span class="tok-k">in</span>
            <span class="tok-o">============================================</span>
            <span class="tok-p">[</span><span class="tok-nx">severe_anaemia_of_pregnancy</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-p">[</span><span class="tok-nx">emergency</span><span class="tok-p">],</span>
            <span class="tok-o">--------------------------------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">anaemia_of_pregnancy</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-p">[</span><span class="tok-nx">high_risk</span><span class="tok-p">],</span>
            <span class="tok-o">--------------------------------------------</span>
            <span class="tok-o">*:</span>                              <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span>
            <span class="tok-o">============================================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">fundal_height_related_risk</span>: <span class="tok-kt">Risk_type</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">ultrasound_finding</span> <span class="tok-k">in</span>
            <span class="tok-o">=================================================</span>
            <span class="tok-p">[</span><span class="tok-nx">interuterine_growth_retardation</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">multiple_pregnancy</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">macrosomia</span><span class="tok-p">]</span><span class="tok-o">:</span>                        <span class="tok-p">[</span><span class="tok-nx">high_risk</span><span class="tok-p">],</span>
            <span class="tok-o">-------------------------------------------------</span>
            <span class="tok-o">*:</span>                                   <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span>
            <span class="tok-o">=================================================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">amniotic_fluid_risk</span>: <span class="tok-kt">Risk_type</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">amniotic_fluid_state</span> <span class="tok-k">in</span>
            <span class="tok-o">=========================================</span>
            <span class="tok-p">[</span><span class="tok-nx">premature_rupture</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">severe_oligohydramnios</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">severe_polyhydramnios</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-p">[</span><span class="tok-nx">emergency</span><span class="tok-p">],</span>
            <span class="tok-o">-----------------------------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">polyhydramnios</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">oligohydramnios</span><span class="tok-p">]</span><span class="tok-o">:</span>           <span class="tok-p">[</span><span class="tok-nx">high_risk</span><span class="tok-p">],</span>
            <span class="tok-o">-----------------------------------------</span>
            <span class="tok-o">*:</span>                            <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span>
            <span class="tok-o">=========================================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">vaginal_bleeding_related_risk</span>: <span class="tok-kt">Risk_type</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">vaginal_physical_exam_assessment</span> <span class="tok-k">in</span>
            <span class="tok-o">=================================================</span>
            <span class="tok-p">[</span><span class="tok-nx">ectopic_pregnancy</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">gestational_trophoblastic_disease</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">emergency</span><span class="tok-p">],</span>
            <span class="tok-o">-------------------------------------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">placenta_previa</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">risk_of_miscarriage</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-p">[</span><span class="tok-nx">high_risk</span><span class="tok-p">],</span>
            <span class="tok-o">-------------------------------------------------</span>
            <span class="tok-o">*:</span>                                   <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span>
            <span class="tok-o">=================================================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">gestational_diabetes_risk</span>: <span class="tok-kt">Risk_type</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">=================================================</span>
            <span class="tok-nx">bmi_range</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">high</span><span class="tok-p">]</span> <span class="tok-nx">or</span>
            <span class="tok-nx">previous_macrosomic_baby</span> <span class="tok-nx">or</span>
            <span class="tok-nx">previous_gestational_diabetes</span> <span class="tok-nx">or</span>
            <span class="tok-nx">family_history_of_diabetes</span> <span class="tok-nx">or</span>
            <span class="tok-nx">race_related_diabetes_risk</span> <span class="tok-nx">or</span>
            <span class="tok-nx">has_gestational_diabetes</span> <span class="tok-nx">or</span>
            <span class="tok-nx">is_type1_diabetic</span><span class="tok-o">:</span>                  <span class="tok-p">[</span><span class="tok-nx">high_risk</span><span class="tok-p">],</span>
            <span class="tok-o">-------------------------------------------------</span>
            <span class="tok-o">*:</span>                                  <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span>
            <span class="tok-o">=================================================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">hypertension_risk</span>: <span class="tok-kt">Risk_type</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">=================================================</span>
            <span class="tok-nx">has_pre_eclampsia</span> <span class="tok-nx">or</span>
            <span class="tok-nx">has_eclampsia</span><span class="tok-o">:</span>                      <span class="tok-p">[</span><span class="tok-nx">emergency</span><span class="tok-p">],</span>
            <span class="tok-o">-------------------------------------------------</span>
            <span class="tok-nx">previous_obstetric_hypertension</span> <span class="tok-nx">or</span>
            <span class="tok-nx">previous_pre_eclampsia</span> <span class="tok-nx">or</span>
            <span class="tok-nx">previous_eclampsia</span> <span class="tok-nx">or</span>
            <span class="tok-nx">has_pregnancy_hypertension</span><span class="tok-o">:</span>         <span class="tok-p">[</span><span class="tok-nx">high_risk</span><span class="tok-p">],</span>
            <span class="tok-o">-------------------------------------------------</span>
            <span class="tok-o">*:</span>                                  <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">]</span>
            <span class="tok-o">=================================================</span>
        <span class="tok-p">;</span>

   <span class="tok-nx">labour_onset_pathway</span>: <span class="tok-kt">Terminology</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">labour_onset_assessment</span> <span class="tok-k">in</span>
            <span class="tok-o">====================================</span>
            <span class="tok-p">[</span><span class="tok-nx">placental_abruption</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">premature_labour</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-p">[</span><span class="tok-nx">emergency</span><span class="tok-p">],</span>
            <span class="tok-o">------------------------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">onset_of_labour</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">labour_first_stage</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-p">[</span><span class="tok-nx">maternity</span><span class="tok-p">],</span>
            <span class="tok-o">------------------------------------</span>
            <span class="tok-o">*:</span>                     <span class="tok-p">[</span><span class="tok-nx">observation</span><span class="tok-p">]</span>
            <span class="tok-o">====================================</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Output</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Return</span> <span class="tok-nx">the</span> <span class="tok-nx">highest</span> <span class="tok-nx">level</span> <span class="tok-nx">risk</span> <span class="tok-nx">of</span> <span class="tok-nx">any</span> <span class="tok-nx">of</span> <span class="tok-nx">the</span>
    <span class="tok-o">|</span> <span class="tok-nx">assessed</span> <span class="tok-nx">risks</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">effective_risk</span>: <span class="tok-kt">Risk_type</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">Result</span><span class="tok-p">.</span><span class="tok-nx">max</span> <span class="tok-p">({</span><span class="tok-nx">fundal_height_related_risk</span><span class="tok-p">,</span>
                    <span class="tok-nx">amniotic_fluid_risk</span><span class="tok-p">,</span>
                    <span class="tok-nx">vaginal_bleeding_related_risk</span><span class="tok-p">,</span>
                    <span class="tok-nx">hypertension_risk</span><span class="tok-p">,</span>
                    <span class="tok-nx">hyperemesis_related_risk</span><span class="tok-p">,</span>
                    <span class="tok-nx">gestational_diabetes_risk</span><span class="tok-p">,</span>
                    <span class="tok-nx">anaemia_risk</span><span class="tok-p">})</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;low_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Normal obstetric care&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;emergency&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Obstetric emergency&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;high_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Refer to high risk care&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;premature_rupture&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Premature rupture of membranes&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;polyhydramnios&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;polyhydramnios&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;oligohydramnios&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;oligohydramnios&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;severe_polyhydramnios&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;severe polyhydramnios&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;severe_oligohydramnios&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;severe oligohydramnios&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;severe_anaemia_of_pregnancy&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;anaemia of pregnancy, severe&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;anaemia_of_pregnancy&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;anaemia of pregnancy&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;amniotic_fluid_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Risk of pregnancy-related amniotic fluid&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;hypertension_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Risk of pregnancy-related hypertension&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;diabetes_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Risk of pregnancy-related diabetes&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;anaemia_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Risk of pregnancy-related anaemia&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;previous_macrosomic_baby&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Baby weighing 4.5kg or above&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;previous_gestational_diabetes&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;xxx&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>

                <span class="tok-s2">&quot;ectopic_pregnancy&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Ectopic pregnancy&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;gestational_trophoblastic_disease&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Gestational trophoblastic disease&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;previous_macrosomic_baby&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Baby weighing 4.5kg or above&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;previous_gestational_diabetes&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;xxx&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">description</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">value_sets</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;amniotic_fluid_state&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;amniotic_fluid_state&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;premature_rupture&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;polyhydramnios&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;oligohydramnios&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;severe_polyhydramnios&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;severe_oligohydramnios&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;anaemia_type&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;anaemia_type&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;excluded&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;anaemia_of_pregnancy&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_breast_cancer_decision_protocol"><a class="anchor" href="#_breast_cancer_decision_protocol"></a>7. Breast Cancer Decision Protocol</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_decision_logic_module"><a class="anchor" href="#_decision_logic_module"></a>7.1. Decision Logic Module</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">guideline</span> <span class="tok-nx">Oncology_breast_cancer</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Historical</span> <span class="tok-nx">state</span>

    <span class="tok-nx">has_heart_failure_class_II</span>: <span class="tok-kt">Boolean</span>

    <span class="tok-nx">has_heart_failure_class_III</span>: <span class="tok-kt">Boolean</span>

    <span class="tok-nx">has_heart_failure_class_IV</span>: <span class="tok-kt">Boolean</span>

    <span class="tok-nx">has_allergy_to_taxanes</span>: <span class="tok-kt">Boolean</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Tracked</span> <span class="tok-nx">State</span>

    <span class="tok-nx">tnm_t</span>: <span class="tok-kt">String</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>

    <span class="tok-nx">tnm_n</span>: <span class="tok-kt">String</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>

    <span class="tok-nx">tnm_m</span>: <span class="tok-kt">String</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>

    <span class="tok-nx">tnm_g</span>: <span class="tok-kt">String</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>

    <span class="tok-nx">estrogen_receptor</span>: <span class="tok-kt">Terminology_term</span> <span class="tok-err">«</span><span class="tok-nx">pos_neg</span><span class="tok-err">»</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>

    <span class="tok-nx">progesterone_receptor</span>:  <span class="tok-kt">Terminology_term</span> <span class="tok-err">«</span><span class="tok-nx">pos_neg</span><span class="tok-err">»</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>

    <span class="tok-nx">her2_expression</span>: <span class="tok-kt">Terminology_term</span> <span class="tok-err">«</span><span class="tok-nx">pos_neg</span><span class="tok-err">»</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>

    <span class="tok-nx">ki67</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;%&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">------------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span> <span class="tok-mi">14</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">high</span><span class="tok-p">],</span>
            <span class="tok-o">|&lt;</span> <span class="tok-mi">14</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">]</span>
            <span class="tok-o">------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">ejection_fraction</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">60</span> <span class="tok-nx">days</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;%&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">-------------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span> <span class="tok-mi">40</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">|&lt;</span> <span class="tok-mi">40</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">]</span>
            <span class="tok-o">-------------------</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Conditions</span>

    <span class="tok-nx">er_negative</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">estrogen_receptor</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">negative</span><span class="tok-p">]</span>

    <span class="tok-nx">er_positive</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">estrogen_receptor</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">positive</span><span class="tok-p">]</span>

    <span class="tok-nx">pr_negative</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">progesterone_receptor</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">negative</span><span class="tok-p">]</span>

    <span class="tok-nx">pr_positive</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">progesterone_receptor</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">positive</span><span class="tok-p">]</span>

    <span class="tok-nx">her2_negative</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">her2_expression</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">negative</span><span class="tok-p">]</span>

    <span class="tok-nx">her2_positive</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">her2_expression</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">positive</span><span class="tok-p">]</span>

    <span class="tok-nx">has_non_class_I_heart_failure</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">has_heart_failure_class_II</span>
                  <span class="tok-nx">or</span> <span class="tok-nx">has_heart_failure_class_III</span>
                  <span class="tok-nx">or</span> <span class="tok-nx">has_heart_failure_class_IV</span>

    <span class="tok-nx">anthracyclines_contraindicated</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">has_transmural_MI</span>
            <span class="tok-nx">or</span> <span class="tok-nx">ejection_fraction</span><span class="tok-p">.</span><span class="tok-nx">in_range</span> <span class="tok-p">([</span><span class="tok-nx">low</span><span class="tok-p">])</span>
            <span class="tok-nx">or</span> <span class="tok-nx">has_non_class_I_heart_failure</span>

    <span class="tok-nx">taxanes_contraindicated</span>:
        <span class="tok-kt">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">is_type1_diabetic</span>
            <span class="tok-nx">or</span> <span class="tok-nx">has_allergy_to_taxanes</span>
            <span class="tok-nx">or</span> <span class="tok-nx">has_intolerance</span> <span class="tok-p">([</span><span class="tok-nx">taxanes</span><span class="tok-p">])</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-nx">molecular_subtype</span>: <span class="tok-kt">Terminology_term</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span>
            <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
                <span class="tok-o">=========================================================</span>
                <span class="tok-nx">er_positive</span> <span class="tok-nx">and</span>
                <span class="tok-nx">her2_negative</span> <span class="tok-nx">and</span>
                <span class="tok-nx">not</span> <span class="tok-nx">ki67</span><span class="tok-p">.</span><span class="tok-nx">in_range</span> <span class="tok-p">([</span><span class="tok-nx">high</span><span class="tok-p">])</span><span class="tok-o">:</span>    <span class="tok-p">[</span><span class="tok-nx">luminal_A</span><span class="tok-p">],</span>
                <span class="tok-o">---------------------------------------------------------</span>
                <span class="tok-nx">er_positive</span> <span class="tok-nx">and</span>
                <span class="tok-nx">her2_negative</span> <span class="tok-nx">and</span>
                <span class="tok-nx">ki67</span><span class="tok-p">.</span><span class="tok-nx">in_range</span> <span class="tok-p">([</span><span class="tok-nx">high</span><span class="tok-p">])</span><span class="tok-o">:</span>        <span class="tok-p">[</span><span class="tok-nx">luminal_B_HER2_negative</span><span class="tok-p">],</span>
                <span class="tok-o">---------------------------------------------------------</span>
                <span class="tok-nx">er_positive</span> <span class="tok-nx">and</span>
                <span class="tok-nx">her2_positive</span><span class="tok-o">:</span>                 <span class="tok-p">[</span><span class="tok-nx">luminal_B_HER2_positive</span><span class="tok-p">],</span>
                <span class="tok-o">---------------------------------------------------------</span>
                <span class="tok-nx">er_negative</span> <span class="tok-nx">and</span>
                <span class="tok-nx">pr_negative</span> <span class="tok-nx">and</span>
                <span class="tok-nx">her2_positive</span> <span class="tok-nx">and</span>
                <span class="tok-nx">ki67</span><span class="tok-p">.</span><span class="tok-nx">in_range</span> <span class="tok-p">([</span><span class="tok-nx">high</span><span class="tok-p">])</span><span class="tok-o">:</span>        <span class="tok-p">[</span><span class="tok-nx">HER2</span><span class="tok-p">],</span>
                <span class="tok-o">---------------------------------------------------------</span>
                <span class="tok-nx">er_negative</span> <span class="tok-nx">and</span>
                <span class="tok-nx">pr_negative</span> <span class="tok-nx">and</span>
                <span class="tok-nx">her2_negative</span> <span class="tok-nx">and</span>
                <span class="tok-nx">ki67</span><span class="tok-p">.</span><span class="tok-nx">in_range</span> <span class="tok-p">([</span><span class="tok-nx">high</span><span class="tok-p">])</span><span class="tok-o">:</span>        <span class="tok-p">[</span><span class="tok-nx">triple_negative</span><span class="tok-p">],</span>
                <span class="tok-o">---------------------------------------------------------</span>
                <span class="tok-o">*:</span>                             <span class="tok-p">[</span><span class="tok-nx">none</span><span class="tok-p">];</span>
                <span class="tok-o">=========================================================</span>
            <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Output</span>

    <span class="tok-nx">chemotherapy_regime</span>: <span class="tok-kt">Terminology_term</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span>
            <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
                <span class="tok-o">================================================================================</span>
                <span class="tok-nx">not</span> <span class="tok-nx">metastatic</span>:
                    <span class="tok-kt">choice</span> <span class="tok-nx">of</span>
                        <span class="tok-o">========================================================================</span>
                        <span class="tok-nx">molecular_subtype</span> <span class="tok-k">in</span>
                            <span class="tok-p">{[</span><span class="tok-nx">luminal_B_HER2_negative</span><span class="tok-p">],</span>
                             <span class="tok-p">[</span><span class="tok-nx">triple_negative</span><span class="tok-p">]}</span> <span class="tok-nx">and</span>
                        <span class="tok-p">(</span><span class="tok-nx">tnm_t</span> <span class="tok-o">&gt;</span> <span class="tok-s1">&#39;1a&#39;</span> <span class="tok-nx">or</span> <span class="tok-nx">tnm_n</span> <span class="tok-o">&gt;</span> <span class="tok-s1">&#39;0&#39;</span><span class="tok-p">)</span><span class="tok-o">:</span>                   <span class="tok-p">[</span><span class="tok-nx">taxanes</span><span class="tok-p">],</span>
                        <span class="tok-o">------------------------------------------------------------------------</span>
                        <span class="tok-nx">molecular_subtype</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">luminal_A</span><span class="tok-p">]</span> <span class="tok-nx">and</span>
                        <span class="tok-p">(</span><span class="tok-nx">tnm_t</span> <span class="tok-err">≥</span> <span class="tok-s1">&#39;3&#39;</span> <span class="tok-nx">or</span> <span class="tok-nx">tnm_n</span> <span class="tok-err">≥</span> <span class="tok-s1">&#39;2&#39;</span> <span class="tok-nx">or</span> <span class="tok-nx">tnm_g</span> <span class="tok-err">≥</span> <span class="tok-s1">&#39;3&#39;</span><span class="tok-p">)</span><span class="tok-o">:</span>  <span class="tok-p">[</span><span class="tok-nx">anthracyclines</span><span class="tok-p">],</span>
                        <span class="tok-o">------------------------------------------------------------------------</span>
                        <span class="tok-nx">molecular_subtype</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">luminal_B_HER2_positive</span><span class="tok-p">]</span> <span class="tok-nx">and</span>
                        <span class="tok-p">(</span><span class="tok-nx">tnm_t</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;1b&#39;</span> <span class="tok-nx">or</span> <span class="tok-nx">tnm_t</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;1c&#39;</span> <span class="tok-nx">and</span> <span class="tok-nx">tnm_n</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;0&#39;</span><span class="tok-p">)</span> <span class="tok-nx">or</span>
                        <span class="tok-nx">molecular_subtype</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">HER2_positive</span><span class="tok-p">]</span> <span class="tok-nx">and</span>
                        <span class="tok-p">(</span><span class="tok-nx">tnm_t</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;1b&#39;</span> <span class="tok-nx">and</span> <span class="tok-nx">tnm_n</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;0&#39;</span><span class="tok-p">)</span><span class="tok-o">:</span>                  <span class="tok-p">[</span><span class="tok-nx">paditaxel_trastuzumab</span><span class="tok-p">]</span>
                        <span class="tok-o">========================================================================</span>
                    <span class="tok-p">;,</span>
                <span class="tok-o">--------------------------------------------------------------------------------</span>
                <span class="tok-o">*:</span>
                    <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
                        <span class="tok-o">=====================</span>
                        <span class="tok-nx">yyy</span>:        <span class="tok-kt">aaa</span><span class="tok-p">,</span>
                        <span class="tok-o">---------------------</span>
                        <span class="tok-nx">xxx</span>:        <span class="tok-kt">bbb</span><span class="tok-p">,</span>
                        <span class="tok-o">---------------------</span>
                        <span class="tok-o">*:</span>          <span class="tok-nx">ccc</span>
                        <span class="tok-o">=====================</span>
                    <span class="tok-p">;</span>
                <span class="tok-o">=================================================================================</span>
            <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;luminal_A&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;luminal A&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;luminal_B_HER2_positive&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;luminal B HER2-positive&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;luminal_B_HER2_negative&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;luminal B HER2-negative&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;HER2_positive&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;HER2-positive&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;HER2_negative&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;HER2-negative&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;triple_negative&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;triple-negative&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;negative&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;negative presence of gene&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;positive&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;positive presence of gene&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">value_sets</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;pos_neg&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;pos_neg&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;positive&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;negative&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_covid19_severity_classification"><a class="anchor" href="#_covid19_severity_classification"></a>8. Covid19 Severity Classification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guideline is a formal expression of the <a href="https://www.acep.org/globalassets/sites/acep/media/covid-19-main/acep_evidencecare_covid19severitytool.pdf" target="_blank" rel="noopener">American College of Emergency Physicians (ACEP) Covid19 Severity Classification tool</a> and as an <a href="https://covid19.evidence.care/dashboard/covid/pathway/198712647/-980102880" target="_blank" rel="noopener">Interactive tool</a>.</p>
</div>
<div class="sect2">
<h3 id="_work_plan_2"><a class="anchor" href="#_work_plan_2"></a>8.1. Work Plan</h3>
<div class="paragraph">
<p>The following work plan is a rendition of the ACEP Covid19 severity guideline multi-step structure.</p>
</div>
<div id="ACEP_covid19_severity" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/diagrams/ACEP_covid19_severity.svg" alt="ACEP covid19 severity">
</div>
<div class="title">Figure 6. ACEP Covid19 Work Plan</div>
</div>
</div>
<div class="sect2">
<h3 id="_decision_logic_module_2"><a class="anchor" href="#_decision_logic_module_2"></a>8.2. Decision Logic Module</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">ACEP_COVID19_severity_classification</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Thomas Beale&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;thomas.beale@openEHR.org&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">organisation</span> <span class="tok-o">:</span>  <span class="tok-s2">&quot;openEHR Foundation &lt;http://www.openEHR.org&gt;&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">date</span>:           <span class="tok-kt">2020</span><span class="tok-o">-</span><span class="tok-mi">12</span><span class="tok-o">-</span><span class="tok-mi">02</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">details</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                    <span class="tok-nx">purpose</span><span class="tok-o">:</span>  <span class="tok-s2">&quot;This tool was developed by ACEP and EvidenceCare to assist</span>
<span class="tok-s2">                                in determining the appropriate evaluation and disposition</span>
<span class="tok-s2">                                for adult patients with suspected or confirmed COVID-19.&quot;</span><span class="tok-p">,</span>
                <span class="tok-p">}</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">copyright</span><span class="tok-o">:</span> <span class="tok-s2">&quot;© 2020 openEHR Foundation&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">licence</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Creative Commons CC-BY &lt;https://creativecommons.org/licenses/by/3.0/&gt;&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">ip_acknowledgements</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;ACEP_EvidenceCare&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span><span class="tok-s2">&quot;This content developed from original publication of</span>
<span class="tok-s2">                    © 2020 American College of Emergency Physicians (ACEP), EvidenceCare,</span>
<span class="tok-s2">                    see https://www.acep.org/globalassets/sites/acep/media/covid-19-main/acep_evidencecare_covid19severitytool.pdf&quot;</span><span class="tok-p">},</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

<span class="tok-nx">use</span>
    <span class="tok-nx">BASIC</span>: <span class="tok-kt">Basic_patient_data.v0.5.0</span>
    <span class="tok-nx">BMI</span>: <span class="tok-kt">Body_mass_index.v0.5.0</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Administrative</span> <span class="tok-nx">State</span>

    <span class="tok-nx">is_LT_care_resident</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Historical</span> <span class="tok-nx">State</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Extract</span> <span class="tok-nx">from</span> <span class="tok-nx">master</span> <span class="tok-nx">problem</span> <span class="tok-nx">list</span> <span class="tok-nx">or</span> <span class="tok-nx">ask</span> <span class="tok-nx">patient</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_cardiovascular_disease</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Extract</span> <span class="tok-nx">from</span> <span class="tok-nx">master</span> <span class="tok-nx">problem</span> <span class="tok-nx">list</span> <span class="tok-nx">or</span> <span class="tok-nx">ask</span> <span class="tok-nx">patient</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has</span> <span class="tok-nx">cerebrovascular_disease</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Extract</span> <span class="tok-nx">from</span> <span class="tok-nx">master</span> <span class="tok-nx">problem</span> <span class="tok-nx">list</span> <span class="tok-nx">or</span> <span class="tok-nx">ask</span> <span class="tok-nx">patient</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_COPD</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Extract</span> <span class="tok-nx">from</span> <span class="tok-nx">master</span> <span class="tok-nx">problem</span> <span class="tok-nx">list</span> <span class="tok-nx">or</span> <span class="tok-nx">ask</span> <span class="tok-nx">patient</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">is_type_2_diabetic</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Extract</span> <span class="tok-nx">from</span> <span class="tok-nx">master</span> <span class="tok-nx">problem</span> <span class="tok-nx">list</span> <span class="tok-nx">or</span> <span class="tok-nx">ask</span> <span class="tok-nx">patient</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_hypertension</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">True</span> <span class="tok-k">if</span> <span class="tok-nx">any</span> <span class="tok-nx">cancer</span> <span class="tok-nx">diagnosis</span> <span class="tok-nx">on</span> <span class="tok-nx">master</span> <span class="tok-nx">problem</span> <span class="tok-nx">list</span>
    <span class="tok-o">|</span> <span class="tok-nx">or</span> <span class="tok-nx">ask</span> <span class="tok-nx">patient</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_malignancy</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Tracked</span> <span class="tok-nx">State</span>

    <span class="tok-nx">heart_rate</span>: <span class="tok-kt">Count</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-nx">min</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;/min&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">------------------------------</span>
            <span class="tok-o">|</span><span class="tok-err">≤</span><span class="tok-mi">99</span><span class="tok-o">|:</span>       <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">100</span><span class="tok-p">..</span><span class="tok-mi">120</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">mild_at_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">121</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">]</span>
            <span class="tok-o">------------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">systolic_BP</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">10</span> <span class="tok-nx">min</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;mm[Hg]&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">------------------------</span>
            <span class="tok-o">|&lt;</span><span class="tok-mi">90</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">critical_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">90</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">normal_risk</span><span class="tok-p">]</span>
            <span class="tok-o">------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Minimum</span> <span class="tok-nx">documented</span> <span class="tok-nx">within</span> <span class="tok-nx">last</span> <span class="tok-mi">8</span> <span class="tok-nx">hrs</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">lowest_SpO2</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">8</span> <span class="tok-nx">hr</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;%&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">----------------------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">93</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">89</span><span class="tok-p">..</span><span class="tok-mi">92</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-err">≤</span><span class="tok-mi">88</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">severe_risk</span><span class="tok-p">]</span>
            <span class="tok-o">----------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">respiratory_rate</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">2</span> <span class="tok-nx">min</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;/min&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">-----------------------------</span>
            <span class="tok-o">|</span><span class="tok-err">≤</span> <span class="tok-mi">22</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">23</span> <span class="tok-p">..</span> <span class="tok-mi">28</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span> <span class="tok-mi">29</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">severe_risk</span><span class="tok-p">]</span>
            <span class="tok-o">-----------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">O2_flow_rate</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">2</span> <span class="tok-nx">min</span><span class="tok-p">,</span>
        <span class="tok-nx">ranges</span><span class="tok-p">[</span><span class="tok-s2">&quot;L/min&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span>
            <span class="tok-o">--------------------------</span>
            <span class="tok-o">|</span><span class="tok-mi">0</span><span class="tok-o">|:</span>      <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">1</span><span class="tok-p">..</span><span class="tok-mi">2</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">mild_at_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-mi">3</span><span class="tok-p">..</span><span class="tok-mi">4</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">5</span><span class="tok-o">|:</span>     <span class="tok-p">[</span><span class="tok-nx">severe_risk</span><span class="tok-p">]</span>
            <span class="tok-o">--------------------------</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Reference</span> <span class="tok-nx">SpO2</span> <span class="tok-k">for</span> <span class="tok-nx">exertional</span> <span class="tok-nx">test</span>: <span class="tok-kt">a</span> <span class="tok-mi">1</span><span class="tok-o">-</span><span class="tok-nx">minute</span> <span class="tok-nx">sit</span><span class="tok-o">-</span><span class="tok-nx">to</span><span class="tok-o">-</span><span class="tok-nx">stand</span>
    <span class="tok-o">|</span> <span class="tok-nx">test</span> <span class="tok-nx">can</span> <span class="tok-nx">be</span> <span class="tok-nx">performed</span> <span class="tok-nx">within</span> <span class="tok-nx">the</span> <span class="tok-nx">patient</span><span class="tok-err">’</span><span class="tok-nx">s</span> <span class="tok-nx">room</span><span class="tok-p">.</span>
    <span class="tok-o">|</span> <span class="tok-nx">With</span> <span class="tok-k">this</span><span class="tok-p">,</span> <span class="tok-nx">they</span> <span class="tok-nx">sit</span> <span class="tok-nx">and</span> <span class="tok-nx">stand</span> <span class="tok-kr">as</span> <span class="tok-nx">many</span> <span class="tok-kr">as</span> <span class="tok-nx">they</span> <span class="tok-nx">can</span> <span class="tok-nx">over</span> <span class="tok-nx">the</span>
    <span class="tok-o">|</span> <span class="tok-nx">course</span> <span class="tok-nx">of</span> <span class="tok-mi">1</span> <span class="tok-nx">minute</span><span class="tok-p">.</span>
    <span class="tok-o">|</span> <span class="tok-o">*</span> <span class="tok-nx">A</span> <span class="tok-mi">3</span><span class="tok-o">%</span> <span class="tok-nx">drop</span> <span class="tok-k">in</span> <span class="tok-nx">pulse</span> <span class="tok-nx">oximeter</span> <span class="tok-nx">reading</span> <span class="tok-nx">is</span> <span class="tok-nx">considered</span> <span class="tok-nx">a</span> <span class="tok-nx">positive</span> <span class="tok-nx">test</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">SpO2_exertion_reference</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-nx">min</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Post</span> <span class="tok-nx">exertion</span> <span class="tok-nx">SpO2</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">SpO2_exertion_post</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-nx">min</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_altered_LOC</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-nx">min</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_hemoptysis</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-nx">min</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_persistent_dyspnea</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-nx">min</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-nx">heart_rate_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">heart_rate</span> <span class="tok-k">in</span>
            <span class="tok-o">=====================</span>
            <span class="tok-o">*:</span>                <span class="tok-mi">0</span>
            <span class="tok-o">=====================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">systolic_BP_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">systolic_BP</span> <span class="tok-k">in</span>
            <span class="tok-o">=====================</span>
            <span class="tok-o">*:</span>                <span class="tok-mi">0</span>
            <span class="tok-o">=====================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">SpO2_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">lowest_SpO2</span> <span class="tok-k">in</span>
            <span class="tok-o">=====================</span>
            <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">severe_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mi">5</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-o">*:</span>                <span class="tok-mi">0</span>
            <span class="tok-o">=====================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">respiratory_rate_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">respiratory_rate</span> <span class="tok-k">in</span>
            <span class="tok-o">=====================</span>
            <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">mild_at_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-o">*:</span>                <span class="tok-mi">0</span>
            <span class="tok-o">=====================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">O2_flow_rate_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">O2_flow_rate</span> <span class="tok-k">in</span>
            <span class="tok-o">=====================</span>
            <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">mild_at_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-mi">4</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">severe_risk</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mi">5</span><span class="tok-p">,</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-o">*:</span>                <span class="tok-mi">0</span>
            <span class="tok-o">=====================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Compute</span> <span class="tok-nx">the</span> <span class="tok-nx">qCSI</span> <span class="tok-nx">score</span> <span class="tok-nx">from</span> <span class="tok-nx">vital</span> <span class="tok-nx">signs</span> <span class="tok-nx">sub</span><span class="tok-o">-</span><span class="tok-nx">scores</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">qCSI_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">heart_rate_score</span> <span class="tok-o">+</span>
                <span class="tok-nx">systolic_BP_score</span> <span class="tok-o">+</span>
                <span class="tok-nx">SpO2_score</span> <span class="tok-o">+</span>
                <span class="tok-nx">respiratory_rate_score</span> <span class="tok-o">+</span>
                <span class="tok-nx">O2_flow_rate_score</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">ACEP</span> <span class="tok-nx">step</span> <span class="tok-mi">2</span> <span class="tok-nx">assessment</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">qCSI_risk</span>: <span class="tok-kt">Terminology_code</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">qCSI_score</span> <span class="tok-k">in</span>
            <span class="tok-o">============================</span>
            <span class="tok-mi">0</span><span class="tok-o">:</span>          <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------</span>
            <span class="tok-o">|</span><span class="tok-mi">1</span><span class="tok-p">..</span><span class="tok-mi">2</span><span class="tok-o">|:</span>     <span class="tok-p">[</span><span class="tok-nx">mild_at_risk</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------</span>
            <span class="tok-o">|</span><span class="tok-mi">3</span><span class="tok-p">..</span><span class="tok-mi">5</span><span class="tok-o">|:</span>     <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------</span>
            <span class="tok-o">|</span><span class="tok-mi">6</span><span class="tok-p">..</span><span class="tok-mi">8</span><span class="tok-o">|:</span>     <span class="tok-p">[</span><span class="tok-nx">severe_risk</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span> <span class="tok-mi">9</span><span class="tok-o">|:</span>     <span class="tok-p">[</span><span class="tok-nx">critical_risk</span><span class="tok-p">]</span>
            <span class="tok-o">============================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Count</span> <span class="tok-nx">demographic</span> <span class="tok-nx">related</span> <span class="tok-nx">risk</span> <span class="tok-nx">factors</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">risk_factors_demographic_count</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span><span class="tok-p">.</span><span class="tok-nx">add</span> <span class="tok-p">(</span>
            <span class="tok-o">------------------------------------</span>
            <span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span>          <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">age</span> <span class="tok-o">&gt;</span> <span class="tok-mi">60</span>              <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">race</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">black_race</span><span class="tok-p">]</span>   <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span>
            <span class="tok-o">------------------------------------</span>
        <span class="tok-p">);</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Count</span> <span class="tok-nx">medical</span> <span class="tok-o">/</span> <span class="tok-nx">history</span> <span class="tok-nx">related</span> <span class="tok-nx">risk</span> <span class="tok-nx">factors</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">risk_factors_medical_count</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span><span class="tok-p">.</span><span class="tok-nx">add</span> <span class="tok-p">(</span>
            <span class="tok-o">--------------------------------------</span>
            <span class="tok-nx">has_cardiovascular_disease</span>    <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has</span> <span class="tok-nx">cerebrovascular_disease</span>   <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has_COPD</span>                      <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">is_type_2_diabetic</span>            <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has_hypertension</span>              <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has_malignancy</span>                <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">BMI</span><span class="tok-p">.</span><span class="tok-nx">bmi</span> <span class="tok-o">&gt;</span> <span class="tok-mi">30</span>                  <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has_renal_disease</span>             <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span>
            <span class="tok-o">--------------------------------------</span>
        <span class="tok-p">);</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Total</span> <span class="tok-nx">pre</span><span class="tok-o">-</span><span class="tok-nx">existing</span> <span class="tok-nx">risk</span> <span class="tok-nx">factors</span> <span class="tok-nx">count</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">risk_factors_count</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">risk_factors_demographic_count</span> <span class="tok-o">+</span>
                  <span class="tok-nx">risk_factors_medical_count</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">ACEP</span> <span class="tok-nx">step</span> <span class="tok-mi">3</span> <span class="tok-nx">assessment</span>
    <span class="tok-o">|</span> <span class="tok-nx">NB</span>: <span class="tok-kt">must</span> <span class="tok-nx">be</span> <span class="tok-nx">assessed</span> <span class="tok-k">in</span> <span class="tok-nx">highest</span> <span class="tok-o">-&gt;</span> <span class="tok-nx">lowest</span> <span class="tok-nx">order</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">symptoms_related_risk</span>: <span class="tok-kt">Terminology_code</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">====================================================</span>
            <span class="tok-nx">has_altered_LOC</span><span class="tok-o">:</span>                    <span class="tok-p">[</span><span class="tok-nx">critical_risk</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-nx">has_hemoptysis</span><span class="tok-o">:</span>                     <span class="tok-p">[</span><span class="tok-nx">severe_risk</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-nx">has_persistent_dyspnea</span> <span class="tok-nx">or</span>
            <span class="tok-nx">is_LT_care_resident</span><span class="tok-o">:</span>                <span class="tok-p">[</span><span class="tok-nx">moderate_risk</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-nx">risk_factors_count</span> <span class="tok-err">∈</span> <span class="tok-p">{</span><span class="tok-o">|</span><span class="tok-err">≥</span> <span class="tok-mi">2</span><span class="tok-o">|</span><span class="tok-p">}</span><span class="tok-o">:</span>     <span class="tok-p">[</span><span class="tok-nx">mild_at_risk</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-nx">risk_factors_count</span> <span class="tok-err">∈</span> <span class="tok-p">{</span><span class="tok-o">|</span><span class="tok-mi">0</span><span class="tok-p">..</span><span class="tok-mi">1</span><span class="tok-o">|</span><span class="tok-p">}</span><span class="tok-o">:</span>     <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">]</span>
            <span class="tok-o">====================================================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Discharge</span> <span class="tok-nx">home</span> <span class="tok-nx">rule</span> <span class="tok-nx">based</span> <span class="tok-nx">on</span> <span class="tok-nx">various</span> <span class="tok-nx">criteria</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">can_discharge</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span>
            <span class="tok-nx">qCSI_risk</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">]</span> <span class="tok-nx">and</span>
            <span class="tok-nx">symptoms_related_risk</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">mild_low_risk</span><span class="tok-p">]</span> <span class="tok-nx">and</span>
            <span class="tok-nx">exertional_SpO2_drop</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">]</span> <span class="tok-nx">and</span>
            <span class="tok-nx">TO</span> <span class="tok-nx">BE</span> <span class="tok-nx">COMPLETED</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Generate</span> <span class="tok-nx">a</span> <span class="tok-o">%</span> <span class="tok-nx">drop</span> <span class="tok-k">in</span> <span class="tok-nx">SpO2</span> <span class="tok-nx">over</span> <span class="tok-mi">1</span> <span class="tok-nx">min</span> <span class="tok-nx">sit</span><span class="tok-o">/</span><span class="tok-nx">stand</span> <span class="tok-nx">exertion</span> <span class="tok-nx">test</span><span class="tok-p">;</span>
    <span class="tok-o">|</span> <span class="tok-nx">NB</span>: <span class="tok-kt">A</span> <span class="tok-nx">fall</span> <span class="tok-k">in</span> <span class="tok-nx">SpO2</span> <span class="tok-nx">generates</span> <span class="tok-nx">a</span> <span class="tok-o">+</span><span class="tok-nx">ve</span> <span class="tok-nx">result</span> <span class="tok-nx">value</span><span class="tok-p">.</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">exertional_SpO2_drop</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">(</span><span class="tok-nx">SpO2_exertion_reference</span> <span class="tok-o">-</span> <span class="tok-nx">SpO2_exertion_post</span><span class="tok-p">)</span><span class="tok-o">/</span><span class="tok-nx">SpO2_exertion_reference</span> <span class="tok-o">*</span> <span class="tok-mi">100</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">exertional_SpO2_result</span>: <span class="tok-kt">Terminology_code</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">exertional_SpO2_drop</span> <span class="tok-k">in</span>
            <span class="tok-o">========================</span>
            <span class="tok-o">|&lt;</span> <span class="tok-mi">3</span><span class="tok-o">%|:</span>   <span class="tok-p">[</span><span class="tok-nx">normal</span><span class="tok-p">],</span>
            <span class="tok-o">------------------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span> <span class="tok-mi">3</span><span class="tok-o">%|:</span>  <span class="tok-p">[</span><span class="tok-nx">mild_at_risk</span><span class="tok-p">]</span>
            <span class="tok-o">========================</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;qCSI_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;qCSI_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;risk_factors_demographic_count&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;risk_factors_medical_count&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;risk_factors_count&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;symptoms_related_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;exertional_SpO2_drop&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;exertional_SpO2_result&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;...&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cha2ds2_vasc"><a class="anchor" href="#_cha2ds2_vasc"></a>9. CHA2DS2-VASc</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_work_plan_3"><a class="anchor" href="#_work_plan_3"></a>9.1. Work Plan</h3>

</div>
<div class="sect2">
<h3 id="_decision_logic_module_3"><a class="anchor" href="#_decision_logic_module_3"></a>9.2. Decision Logic Module</h3>
<div class="paragraph">
<p>This DLM is a direct translation of the Cambio <a href="https://github.com/gdl-lang/common-clinical-models/blob/master/guidelines/CHA2DS2-VASc.v1.gdl" target="_blank" rel="noopener">CHA2DS2-VASc.v1</a> GDL2 guideline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">CHA2DS2_VASc</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Thomas Beale&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;models@cambiocds.com&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">organisation</span><span class="tok-o">:</span>   <span class="tok-s2">&quot;Cambio Healthcare Systems &lt;https://www.cambiogroup.com&gt;&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">date</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;2016-12-16&quot;</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">details</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                    <span class="tok-nx">purpose</span><span class="tok-o">:</span> <span class="tok-s2">&quot;To record an individual&#39;s CHA2DS2-VASc score parameters and total score.&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">use</span><span class="tok-o">:</span>     <span class="tok-s2">&quot;Use for stroke risk stratification in patients with atrial fibrillation.</span>
<span class="tok-s2">                             CHA2DS2-VASc is an acronym, with each factor contributing points to the</span>
<span class="tok-s2">                                total score:</span>
<span class="tok-s2">                                - Congestive heart failure 1p</span>
<span class="tok-s2">                                - Hypertension 1p</span>
<span class="tok-s2">                                - Age ≥75 years 2p</span>
<span class="tok-s2">                                - Diabetes1p</span>
<span class="tok-s2">                                - Stroke 2p</span>
<span class="tok-s2">                                - Vascular disease 1p</span>
<span class="tok-s2">                                - Age 65–74 years 1p</span>
<span class="tok-s2">                                - Sex category 1p for female&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">copyright</span><span class="tok-o">:</span>  <span class="tok-s2">&quot;© 2021 openEHR Foundation&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">licence</span><span class="tok-o">:</span>    <span class="tok-s2">&quot;Creative Commons CC-BY &lt;https://creativecommons.org/licenses/by/3.0/&gt;&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">ip_acknowledgements</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;ClinRisk&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;This content developed from original publication of</span>
<span class="tok-s2">                    © 2017 ClinRisk Ltd., see https://qrisk.org&quot;</span><span class="tok-p">,</span>
                <span class="tok-s2">&quot;QRISK&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;QRISK® is a registered trademark of the University of Nottingham and EMIS&quot;</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">references</span><span class="tok-o">:</span> <span class="tok-p">[</span>
                <span class="tok-s2">&quot;Lip GY, Nieuwlaat R, Pisters R, Lane DA, Crijns HJ. Refining clinical risk</span>
<span class="tok-s2">                    stratification for predicting stroke and thromboembolism in atrial</span>
<span class="tok-s2">                    fibrillation using a novel risk factor-based approach: the euro heart survey</span>
<span class="tok-s2">                    on atrial fibrillation. Chest. 2010 Feb;137(2):263-72.&quot;</span><span class="tok-p">,</span>

                <span class="tok-s2">&quot;Camm a J, Kirchhof P, Lip GYH, Schotten U, Savelieva I, Ernst S, et al.</span>
<span class="tok-s2">                    Guidelines for the management of atrial fibrillation: the Task Force for</span>
<span class="tok-s2">                    the Management of Atrial Fibrillation of the European Society of Cardiology</span>
<span class="tok-s2">                    (ESC). Eur Heart J. 2010 Oct;31(19):2369–429.&quot;</span><span class="tok-p">,</span>

                <span class="tok-s2">&quot;Lip GY, Frison L, Halperin JL, Lane DA. Identifying patients at high risk</span>
<span class="tok-s2">                    for stroke despite anticoagulation: a comparison of contemporary stroke risk</span>
<span class="tok-s2">                    stratification schemes in an anticoagulated atrial fibrillation cohort.</span>
<span class="tok-s2">                    Stroke. 2010 Dec;41(12):2731-8.&quot;</span><span class="tok-p">,</span>

                <span class="tok-s2">&quot;Friberg L, Rosenqvist M, Lip GY. Evaluation of risk stratification schemes</span>
<span class="tok-s2">                    for ischaemic stroke and bleeding in 182 678 patients with atrial</span>
<span class="tok-s2">                    fibrillation: the Swedish Atrial Fibrillation cohort study.</span>
<span class="tok-s2">                    Eur Heart J. 2012 Jun;33(12):1500-10.&quot;</span>
            <span class="tok-p">]</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

<span class="tok-nx">use</span>
    <span class="tok-nx">BASIC</span>: <span class="tok-kt">Basic_patient_data</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Historical</span> <span class="tok-nx">state</span>

    <span class="tok-nx">has_congestive_heart_failure</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_hypertension</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Has</span> <span class="tok-nx">recently</span> <span class="tok-nx">had</span> <span class="tok-nx">or</span> <span class="tok-nx">currently</span> <span class="tok-nx">has</span> <span class="tok-nx">a</span> <span class="tok-nx">stroke</span><span class="tok-p">,</span> <span class="tok-nx">TIA</span> <span class="tok-nx">or</span> <span class="tok-nx">thromboembolism</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_stroke_TIA_thromboembolism</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_diabetes</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_vascular_disease</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Convert</span> <span class="tok-nx">sex</span> <span class="tok-nx">to</span> <span class="tok-nx">binary</span> <span class="tok-nx">gender</span><span class="tok-p">;</span>
    <span class="tok-o">|</span> <span class="tok-nx">treat</span> <span class="tok-nx">indeterminate</span> <span class="tok-nx">sex</span> <span class="tok-kr">as</span> <span class="tok-nx">female</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">gender</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">sexes</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span> <span class="tok-k">in</span>
            <span class="tok-o">=====================</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">],</span>
            <span class="tok-o">---------------------</span>
            <span class="tok-o">*:</span>          <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span>
            <span class="tok-o">=====================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">age_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">age_in_years</span> <span class="tok-k">in</span>
            <span class="tok-o">================</span>
            <span class="tok-o">|&lt;</span><span class="tok-mi">65</span><span class="tok-o">|:</span>       <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-mi">65</span><span class="tok-p">..</span><span class="tok-mi">74</span><span class="tok-o">|:</span>    <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">75</span><span class="tok-o">|:</span>      <span class="tok-mi">2</span>
            <span class="tok-o">================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">CHA2DS2_VASc_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span><span class="tok-p">.</span><span class="tok-nx">add</span> <span class="tok-p">(</span>
            <span class="tok-o">---------------------------------------------</span>
            <span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">gender</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span>                <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">age_score</span><span class="tok-p">,</span>
            <span class="tok-nx">has_congestive_heart_failure</span>         <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has_hypertension</span>                     <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has_stroke_TIA_thromboembolism</span>       <span class="tok-o">?</span> <span class="tok-nx">2</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has_vascular_disease</span>                 <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span><span class="tok-p">,</span>
            <span class="tok-nx">has_diabetes</span>                         <span class="tok-o">?</span> <span class="tok-nx">1</span> : <span class="tok-kt">0</span>
            <span class="tok-o">---------------------------------------------</span>
        <span class="tok-p">)</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Output</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">The</span> <span class="tok-nx">maximum</span> <span class="tok-nx">score</span> <span class="tok-nx">is</span> <span class="tok-mi">9</span> <span class="tok-nx">and</span> <span class="tok-nx">the</span> <span class="tok-nx">result</span> <span class="tok-nx">is</span> <span class="tok-nx">interpreted</span> <span class="tok-kr">as</span><span class="tok-p">;</span>
    <span class="tok-o">|</span> <span class="tok-mi">0</span> <span class="tok-o">-</span> <span class="tok-nx">low</span> <span class="tok-nx">risk</span>
    <span class="tok-o">|</span> <span class="tok-mi">1</span> <span class="tok-o">-</span> <span class="tok-nx">intermediate</span> <span class="tok-nx">risk</span>
    <span class="tok-o">|</span> <span class="tok-mi">2</span> <span class="tok-nx">or</span> <span class="tok-nx">more</span> <span class="tok-o">-</span> <span class="tok-nx">high</span> <span class="tok-nx">risk</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">risk_assessment</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">risks</span><span class="tok-err">»</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">CHA2DS2_VASc_score</span> <span class="tok-k">in</span>
            <span class="tok-o">=============================</span>
            <span class="tok-mi">0</span><span class="tok-o">:</span>       <span class="tok-p">[</span><span class="tok-nx">low_risk</span><span class="tok-p">],</span>
            <span class="tok-mi">1</span><span class="tok-o">:</span>       <span class="tok-p">[</span><span class="tok-nx">intermediate_risk</span><span class="tok-p">],</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">2</span><span class="tok-o">|:</span>   <span class="tok-p">[</span><span class="tok-nx">high_risk</span><span class="tok-p">]</span>
            <span class="tok-o">=============================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Further</span> <span class="tok-nx">interpretation</span> <span class="tok-k">in</span> <span class="tok-nx">accordance</span> <span class="tok-kd">with</span> <span class="tok-p">[</span><span class="tok-mi">4</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">annual_stroke_risk</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">CHA2DS2_VASc_score</span> <span class="tok-k">in</span>
            <span class="tok-o">==============</span>
            <span class="tok-nx">0</span>:       <span class="tok-kt">0.0</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">1</span>:       <span class="tok-kt">0.6</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">2</span>:       <span class="tok-kt">2.2</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">3</span>:       <span class="tok-kt">3.2</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">4</span>:       <span class="tok-kt">4.8</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">5</span>:       <span class="tok-kt">7.2</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">6</span>:       <span class="tok-kt">9.7</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">7</span>:      <span class="tok-kt">11.2</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">8</span>:      <span class="tok-kt">10.8</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">9</span>:      <span class="tok-kt">12.2</span><span class="tok-o">%</span>
            <span class="tok-o">==============</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Further</span> <span class="tok-nx">interpretation</span> <span class="tok-k">in</span> <span class="tok-nx">accordance</span> <span class="tok-kd">with</span> <span class="tok-p">[</span><span class="tok-mi">4</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">annual_stroke_TIA_thromboembolism_risk</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">CHA2DS2_VASc_score</span> <span class="tok-k">in</span>
            <span class="tok-o">==============</span>
            <span class="tok-nx">0</span>:       <span class="tok-kt">0.0</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">1</span>:       <span class="tok-kt">0.9</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">2</span>:       <span class="tok-kt">2.9</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">3</span>:       <span class="tok-kt">4.6</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">4</span>:       <span class="tok-kt">6.7</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">5</span>:      <span class="tok-kt">10.0</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">6</span>:      <span class="tok-kt">13.6</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">7</span>:      <span class="tok-kt">15.7</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">8</span>:      <span class="tok-kt">15.2</span><span class="tok-o">%</span><span class="tok-p">,</span>
            <span class="tok-nx">9</span>:      <span class="tok-kt">17.4</span><span class="tok-o">%</span>
            <span class="tok-o">==============</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;date_of_birth&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Date of birth&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0009&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;age_in_years&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Age (years)&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0010&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;age_category&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Age category&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0017&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;gender&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Gender&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0009&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;gt0016&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;has_congestive_heart_failure&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;xxx&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0011&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;gt0018&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;has_hypertension&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;xxx&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0012&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;gt0019&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;has_diabetes&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Diabetes&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0015&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;gt0022&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;has_stroke_TIA_thromboembolism&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Stroke/TIA/Thromboembolism&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0013&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;gt0020&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;has_vascular_disease&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Vascular disease&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0014&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;gt0021&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;male&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Male gender&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0035&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;female&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Female gender&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0025&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;CHA2DS2_VASc_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;CHA2DS2VASc score&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0011&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;risk_assessment&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Risk assessment&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0005&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;annual_stroke_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Annual stroke risk&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0006&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;annual_stroke_TIA_thromboembolism_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Annual risk of stroke/TIA/thromboembolism&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">provenance</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GDL2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;gt0011&quot;</span><span class="tok-p">]</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;low_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Low risk&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;intermediate_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Intermediate risk&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;high_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;High risk&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">value_sets</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;genders&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;genders&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;male&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;female&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;risks&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;risks&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;low_risk&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;intermediate_risk&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;high_risk&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bindings"><a class="anchor" href="#_bindings"></a>9.3. Bindings</h3>
<div class="paragraph">
<p>The following defines the logical bindings of DLM variables to back-end data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--
-- Demographic items: AQL query
--
SELECT
    OBS/data[at0001]/events[at0002]/data[at0003]/items[at0004] AS date_of_birth,
    OBS/data[at0001]/events[at0002]/data[at0003]/items[at0008] AS sex
    C/context/start_time AS time
FROM
    EHR e[ehr_id/value=$ehrUid]
        CONTAINS COMPOSITION C
        CONTAINS OBSERVATION OBS[openEHR-EHR-OBSERVATION.basic_demographic.v1]
ORDER BY
    time DESC


--
-- CHA2DS2-VASc input items
--
SELECT
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0026] AS has_congestive_heart_failure,
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0029] AS has_hypertension,
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0039] AS has_stroke_TIA_thromboembolism,
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0046] AS has_vascular_disease,
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0032] AS has_diabetes,
    C/context/start_time AS time
FROM
    EHR e[ehr_id/value=$ehrUid]
        CONTAINS COMPOSITION C
        CONTAINS OBSERVATION OBS[openEHR-EHR-OBSERVATION.chadsvasc_score.v1]
ORDER BY
    time DESC</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qrisk3_2017"><a class="anchor" href="#_qrisk3_2017"></a>10. qRisk3-2017</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This stroke/heart attack risk calculator was developed in the UK by University of Nottingham and EMIS (a major GP EMR supplier). An online calculator is <a href="https://qrisk.org/three/index.php" target="_blank" rel="noopener">visible here</a>. The algorithm is <a href="https://qrisk.org/three/src.php" target="_blank" rel="noopener">published as a PHP program</a>. See also <a href="https://www.bmj.com/content/357/bmj.j2099" target="_blank" rel="noopener">this article</a>.</p>
</div>
<div class="paragraph">
<p>What we can show here is how to represent the algorithm in a way that clinicians can directly understand, and indeed, could develop and maintain, given appropriate tools.</p>
</div>
<div class="sect2">
<h3 id="_decision_logic_module_4"><a class="anchor" href="#_decision_logic_module_4"></a>10.1. Decision Logic Module</h3>
<div class="paragraph">
<p>This DLM is a fairly literal rendering of the algorithm at the above link, with a cleaner representation of the scale factors, and a bit of vector math.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">qRisk3_2017</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Thomas Beale&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;thomas.beale@openEHR.org&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">organisation</span><span class="tok-o">:</span>   <span class="tok-s2">&quot;openEHR International &lt;http://www.openEHR.org&gt;&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">date</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;2021-01-10&quot;</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">details</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                    <span class="tok-nx">purpose</span><span class="tok-o">:</span> <span class="tok-s2">&quot;To record an individual&#39;s QRISK3 score.&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">copyright</span><span class="tok-o">:</span>  <span class="tok-s2">&quot;© 2021 openEHR Foundation&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">licence</span><span class="tok-o">:</span>    <span class="tok-s2">&quot;Creative Commons CC-BY &lt;https://creativecommons.org/licenses/by/3.0/&gt;&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">ip_acknowledgements</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;ClinRisk&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;This content developed from original publication of</span>
<span class="tok-s2">                    © 2017 ClinRisk Ltd., see https://qrisk.org&quot;</span><span class="tok-p">,</span>
                <span class="tok-s2">&quot;QRISK&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;QRISK® is a registered trademark of the University of Nottingham and EMIS&quot;</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

<span class="tok-nx">use</span>
    <span class="tok-nx">BASIC</span>: <span class="tok-kt">Basic_patient_data.v0.5.0</span>
    <span class="tok-nx">BMI</span>: <span class="tok-kt">Body_mass_index.v0.5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Reference</span>

    <span class="tok-nx">Ethnicity_risk_factors</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">white_or_not_stated</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-mf">0.280403143329954250</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">indian</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-mf">0.562989941420753980</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">pakistani</span><span class="tok-p">]</span><span class="tok-o">:</span>            <span class="tok-mf">0.295900008511165160</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">bangladeshi</span><span class="tok-p">]</span><span class="tok-o">:</span>          <span class="tok-mf">0.072785379877982545</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">other_asian</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-o">-</span><span class="tok-mf">0.170721355088573170</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">black_caribbean</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-o">-</span><span class="tok-mf">0.393710433148749710</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">black_african</span><span class="tok-p">]</span><span class="tok-o">:</span>       <span class="tok-o">-</span><span class="tok-mf">0.326324952835302720</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">other_ethnic_group</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-o">-</span><span class="tok-mf">0.171270568832417840</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">white_or_not_stated</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-mf">0.277192487603082790</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">indian</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-mf">0.474463607149312680</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">pakistani</span><span class="tok-p">]</span><span class="tok-o">:</span>            <span class="tok-mf">0.529617299196893710</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">bangladeshi</span><span class="tok-p">]</span><span class="tok-o">:</span>          <span class="tok-mf">0.035100159186299017</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">other_asian</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-o">-</span><span class="tok-mf">0.358078996693279190</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">black_caribbean</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-o">-</span><span class="tok-mf">0.400564852321651400</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">black_african</span><span class="tok-p">]</span><span class="tok-o">:</span>       <span class="tok-o">-</span><span class="tok-mf">0.415227928898301730</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">other_ethnic_group</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-o">-</span><span class="tok-mf">0.263213481347499670</span>
            <span class="tok-p">},</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Smoking_risk_factors</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">non_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>           <span class="tok-mi">0</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">ex_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>            <span class="tok-mf">0.133868337865462620</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">light_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-mf">0.562008580124385370</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">moderate_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>      <span class="tok-mf">0.667495933775025470</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">heavy_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-mf">0.849481776448308470</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">non_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>           <span class="tok-mi">0</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">ex_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>            <span class="tok-mf">0.191282228633889830</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">light_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-mf">0.552415881926455520</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">moderate_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>      <span class="tok-mf">0.638350530275060720</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">heavy_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>         <span class="tok-mf">0.789838198818580190</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Age_1_stats</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.053274843841791</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-o">-</span><span class="tok-mf">8.138810924772618800</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.053274843841791</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-o">-</span><span class="tok-mf">17.839781666005575000</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Age_2_stats</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">4.332503318786621</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.797333766896990980</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">77.284080505371094</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0022964880605765492</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">BMI_1_stats</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.154946178197861</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.292360922754600520</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.149176135659218</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">2.456277666053635800</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">BMI_2_stats</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.144462317228317</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-o">-</span><span class="tok-mf">4.151330021383766500</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.141913309693336</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-o">-</span><span class="tok-mf">8.301112231471135400</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Rheumatoid_arthritis_stats</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">3.476326465606690</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.153380358208025540</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">4.300998687744141</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.173401968563271110</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Systolic_BP_stats</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">123.130012512207030</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0131314884071034240</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">128.571578979492190</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0129101265425533050</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Systolic_BP_std_dev_stats</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">9.002537727355957</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0078894541014586095</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">8.756621360778809</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0129101265425533050</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Townsend_stats</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.392308831214905</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0772237905885901080</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">centre</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.526304900646210</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">scale</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0332682012772872950</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Risk_factor_scales</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">has_atrial_fibrillation</span><span class="tok-p">]</span><span class="tok-o">:</span>              <span class="tok-mf">1.59233549692696630</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">atypical_antipsychotic_medication</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.252376420701155570</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">on_corticosteroids</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-mf">0.595207253046018510</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_impotence</span><span class="tok-p">]</span><span class="tok-o">:</span>                        <span class="tok-mi">0</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_migraines</span><span class="tok-p">]</span><span class="tok-o">:</span>                        <span class="tok-mf">0.3012672608703450</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_rheumatoid_arthritis</span><span class="tok-p">]</span><span class="tok-o">:</span>             <span class="tok-mf">0.213648034351819420</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_chronic_kidney_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>           <span class="tok-mf">0.651945694938458330</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_severe_mental_illness</span><span class="tok-p">]</span><span class="tok-o">:</span>            <span class="tok-mf">0.125553080588201780</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_systemic_lupus</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-mf">0.758809386542676930</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">on_hypertension_treatment</span><span class="tok-p">]</span><span class="tok-o">:</span>            <span class="tok-mf">0.509315936834230040</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_family_history_CV_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>        <span class="tok-mf">0.454453190208962130</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">has_atrial_fibrillation</span><span class="tok-p">]</span><span class="tok-o">:</span>              <span class="tok-mf">0.882092369280546570</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">atypical_antipsychotic_medication</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.130468798551735130</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">on_corticosteroids</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-mf">0.454853997504455430</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_impotence</span><span class="tok-p">]</span><span class="tok-o">:</span>                        <span class="tok-mf">0.222518590867053830</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_migraines</span><span class="tok-p">]</span><span class="tok-o">:</span>                        <span class="tok-mf">0.255841780741599130</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_rheumatoid_arthritis</span><span class="tok-p">]</span><span class="tok-o">:</span>             <span class="tok-mf">0.209706580139565670</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_chronic_kidney_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>           <span class="tok-mf">0.718532612882743840</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_severe_mental_illness</span><span class="tok-p">]</span><span class="tok-o">:</span>            <span class="tok-mf">0.121330398820471640</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_systemic_lupus</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-mf">0.440157217445752200</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">on_hypertension_treatment</span><span class="tok-p">]</span><span class="tok-o">:</span>            <span class="tok-mf">0.516598710826954740</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">has_family_history_CV_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>        <span class="tok-mf">0.540554690093901560</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Diabetes_scales</span><span class="tok-o">:</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">no_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>      <span class="tok-mi">0</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">type1_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">1.72679775105373470</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">type2_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">1.06887732446154680</span>
            <span class="tok-p">}</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-p">[</span><span class="tok-nx">no_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>      <span class="tok-mi">0</span><span class="tok-p">,</span>
                <span class="tok-p">[</span><span class="tok-nx">type1_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">1.234342552167517500</span>
                <span class="tok-p">[</span><span class="tok-nx">type2_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">0.859420714309322210</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Interaction_scales</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                 <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_atrial_fibrillation</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-mf">19.9380348895465610</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">on_corticosteroids</span><span class="tok-p">]</span><span class="tok-o">:</span>          <span class="tok-o">-</span><span class="tok-mf">0.9840804523593628100000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_impotence</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_migraines</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-mf">1.7634979587872999000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_chronic_kidney_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-o">-</span><span class="tok-mf">3.5874047731694114000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_systemic_lupus</span><span class="tok-p">]</span><span class="tok-o">:</span>          <span class="tok-mf">19.6903037386382920000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">on_hypertension_treatment</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-mf">11.8728097339218120000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">bmi_1</span><span class="tok-p">]</span><span class="tok-o">:</span>                       <span class="tok-mf">23.8026234121417420000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">bmi_2</span><span class="tok-p">]</span><span class="tok-o">:</span>                      <span class="tok-o">-</span><span class="tok-mf">71.1849476920870070000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">family_history_CV_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.9946780794043512700000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">systolic_BP</span><span class="tok-p">]</span><span class="tok-o">:</span>                  <span class="tok-mf">0.0341318423386154850000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">townsend</span><span class="tok-p">]</span><span class="tok-o">:</span>                    <span class="tok-o">-</span><span class="tok-mf">1.0301180802035639000000000</span>
                <span class="tok-p">},</span>
                <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_atrial_fibrillation</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-o">-</span><span class="tok-mf">0.0761826510111625050000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">on_corticosteroids</span><span class="tok-p">]</span><span class="tok-o">:</span>          <span class="tok-o">-</span><span class="tok-mf">0.1200536494674247200000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_impotence</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_migraines</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-o">-</span><span class="tok-mf">0.0655869178986998590000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_chronic_kidney_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-o">-</span><span class="tok-mf">0.2268887308644250700000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_systemic_lupus</span><span class="tok-p">]</span><span class="tok-o">:</span>           <span class="tok-mf">0.0773479496790162730000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">on_hypertension_treatment</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0009685782358817443600000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">bmi_1</span><span class="tok-p">]</span><span class="tok-o">:</span>                        <span class="tok-mf">0.5236995893366442900000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">bmi_2</span><span class="tok-p">]</span><span class="tok-o">:</span>                        <span class="tok-mf">0.0457441901223237590000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">family_history_CV_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-o">-</span><span class="tok-mf">0.0768850516984230380000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">systolic_BP</span><span class="tok-p">]</span><span class="tok-o">:</span>                 <span class="tok-o">-</span><span class="tok-mf">0.0015082501423272358000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">townsend</span><span class="tok-p">]</span><span class="tok-o">:</span>                    <span class="tok-o">-</span><span class="tok-mf">0.0315934146749623290000000</span>
                <span class="tok-p">}</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                 <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_atrial_fibrillation</span><span class="tok-p">]</span><span class="tok-o">:</span>      <span class="tok-mf">3.4896675530623207000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">on_corticosteroids</span><span class="tok-p">]</span><span class="tok-o">:</span>           <span class="tok-mf">1.1708133653489108000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_impotence</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-o">-</span><span class="tok-mf">1.5064009857454310000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_migraines</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-mf">2.3491159871402441000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_chronic_kidney_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-o">-</span><span class="tok-mf">0.5065671632722369400000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">on_hypertension_treatment</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">6.5114581098532671000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">bmi_1</span><span class="tok-p">]</span><span class="tok-o">:</span>                       <span class="tok-mf">31.0049529560338860000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">bmi_2</span><span class="tok-p">]</span><span class="tok-o">:</span>                     <span class="tok-o">-</span><span class="tok-mf">111.2915718439164300000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">family_history_CV_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">2.7808628508531887000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">systolic_BP</span><span class="tok-p">]</span><span class="tok-o">:</span>                  <span class="tok-mf">0.0188585244698658530000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">townsend</span><span class="tok-p">]</span><span class="tok-o">:</span>                    <span class="tok-o">-</span><span class="tok-mf">0.1007554870063731000000000</span>
                <span class="tok-p">},</span>
                <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_atrial_fibrillation</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-o">-</span><span class="tok-mf">0.0003499560834063604900000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">on_corticosteroids</span><span class="tok-p">]</span><span class="tok-o">:</span>          <span class="tok-o">-</span><span class="tok-mf">0.0002496045095297166000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_impotence</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-o">-</span><span class="tok-mf">0.0011058218441227373000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_migraines</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-mf">0.0001989644604147863100000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">has_chronic_kidney_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-o">-</span><span class="tok-mf">0.0018325930166498813000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">on_hypertension_treatment</span><span class="tok-p">]</span><span class="tok-o">:</span>    <span class="tok-mf">0.0006383805310416501300000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">bmi_1</span><span class="tok-p">]</span><span class="tok-o">:</span>                        <span class="tok-mf">0.0050380102356322029000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">bmi_2</span><span class="tok-p">]</span><span class="tok-o">:</span>                       <span class="tok-o">-</span><span class="tok-mf">0.0130744830025243190000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">family_history_CV_disease</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-o">-</span><span class="tok-mf">0.0002479180990739603700000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">systolic_BP</span><span class="tok-p">]</span><span class="tok-o">:</span>                 <span class="tok-o">-</span><span class="tok-mf">0.0000127187419158845700000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">townsend</span><span class="tok-p">]</span><span class="tok-o">:</span>                    <span class="tok-o">-</span><span class="tok-mf">0.0000932996423232728880000</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Snoking_interaction_scales</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                 <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">non_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">ex_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-o">-</span><span class="tok-mf">4.70571617858518910</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">light_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-o">-</span><span class="tok-mf">2.74303834035733370</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">moderate_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>             <span class="tok-o">-</span><span class="tok-mf">0.866080888293921820</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">heavy_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                 <span class="tok-mf">0.902415623697106480</span>
                <span class="tok-p">},</span>
                <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">non_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">ex_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-o">-</span><span class="tok-mf">0.0755892446431930260000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">light_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-o">-</span><span class="tok-mf">0.1195119287486707400000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">moderate_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>             <span class="tok-o">-</span><span class="tok-mf">0.1036630639757192300000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">heavy_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-o">-</span><span class="tok-mf">0.1399185359171838900000000</span>
                <span class="tok-p">}</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                 <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">non_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">ex_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-o">-</span><span class="tok-mf">0.2101113393351634600000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">light_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                 <span class="tok-mf">0.7526867644750319100000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">moderate_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>              <span class="tok-mf">0.9931588755640579100000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">heavy_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                 <span class="tok-mf">2.1331163414389076000000000</span>
                <span class="tok-p">},</span>
                <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">non_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">ex_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                   <span class="tok-o">-</span><span class="tok-mf">0.0004985487027532612100000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">light_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-o">-</span><span class="tok-mf">0.0007987563331738541400000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">moderate_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>             <span class="tok-o">-</span><span class="tok-mf">0.0008370618426625129600000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">heavy_smoker</span><span class="tok-p">]</span><span class="tok-o">:</span>                <span class="tok-o">-</span><span class="tok-mf">0.0007840031915563728900000</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">Diabetes_interaction_scales</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                 <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">no_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>                  <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">type1_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>              <span class="tok-o">-</span><span class="tok-mf">1.2444332714320747000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">type2_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-mf">6.8652342000009599000000000</span>
                <span class="tok-p">},</span>
                <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">no_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>                  <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">type1_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>              <span class="tok-o">-</span><span class="tok-mf">0.2872406462448894900000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">type2_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>              <span class="tok-o">-</span><span class="tok-mf">0.0971122525906954890000000</span>
                <span class="tok-p">}</span>
            <span class="tok-p">},</span>
            <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                 <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">no_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>                  <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">type1_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-mf">5.3379864878006531000000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">type2_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-mf">3.6461817406221311000000000</span>
                <span class="tok-p">},</span>
                <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">]</span><span class="tok-o">:</span>   <span class="tok-p">{</span>
                    <span class="tok-p">[</span><span class="tok-nx">no_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>                  <span class="tok-mi">0</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">type1_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>               <span class="tok-mf">0.0006409780808752897000000</span><span class="tok-p">,</span>
                    <span class="tok-p">[</span><span class="tok-nx">type2_diabetes</span><span class="tok-p">]</span><span class="tok-o">:</span>              <span class="tok-o">-</span><span class="tok-mf">0.0002469569558886831500000</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Administrative</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Ethnicity</span> <span class="tok-k">for</span> <span class="tok-nx">qRisk3</span><span class="tok-o">:</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">white_or_not_stated</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">indian</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">pakistani</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">bangladeshi</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">other_asian</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">black_caribbean</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">black_african</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">other_ethnic_group</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">qRisk3_ethnicity</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">qrisk_ethnicities</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">townsend</span>: <span class="tok-kt">Real</span>
        <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Historical</span> <span class="tok-nx">state</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Smoking</span> <span class="tok-nx">status</span><span class="tok-o">:</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">non_smoker</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">ex_smoker</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">light_smoker</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">moderate_smoker</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">heavy_smoker</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">smoking_status</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">smoking_status</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Diabetes</span><span class="tok-o">:</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">no_diabetes</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">type1_diabetes</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">type2_diabetes</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">diabetes_status</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">diabetes_status</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Angina</span> <span class="tok-nx">or</span> <span class="tok-nx">heart</span> <span class="tok-nx">attack</span> <span class="tok-k">in</span> <span class="tok-nx">a</span> <span class="tok-mi">1</span><span class="tok-nx">st</span> <span class="tok-nx">degree</span> <span class="tok-nx">relative</span> <span class="tok-o">&lt;</span> <span class="tok-mi">60</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">family_history_CV_disease</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Chronic</span> <span class="tok-nx">kidney</span> <span class="tok-nx">disease</span> <span class="tok-p">(</span><span class="tok-nx">stage</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span> <span class="tok-nx">or</span> <span class="tok-mi">5</span><span class="tok-p">)</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_chronic_kidney_disease</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_atrial_fibrillation</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">on_hypertension_treatment</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_migraines</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">has_rheumatoid_arthritis</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Has</span> <span class="tok-nx">or</span> <span class="tok-nx">being</span> <span class="tok-nx">treated</span> <span class="tok-k">for</span> <span class="tok-nx">erectile</span> <span class="tok-nx">dysfunction</span>
    <span class="tok-o">|</span> <span class="tok-p">(</span><span class="tok-nx">female</span> <span class="tok-o">-&gt;</span> <span class="tok-nx">False</span><span class="tok-p">)</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_impotence</span>: <span class="tok-kt">Boolean</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Has</span> <span class="tok-nx">Systemic</span> <span class="tok-nx">lupus</span> <span class="tok-nx">erythematosus</span> <span class="tok-p">(</span><span class="tok-nx">SLE</span><span class="tok-p">)</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_systemic_lupus</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Severe</span> <span class="tok-nx">mental</span> <span class="tok-nx">illness</span> <span class="tok-p">(</span><span class="tok-k">this</span> <span class="tok-nx">includes</span> <span class="tok-nx">schizophrenia</span><span class="tok-p">,</span>
    <span class="tok-o">|</span> <span class="tok-nx">bipolar</span> <span class="tok-nx">disorder</span> <span class="tok-nx">and</span> <span class="tok-nx">moderate</span><span class="tok-o">/</span><span class="tok-nx">severe</span> <span class="tok-nx">depression</span><span class="tok-p">)</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_severe_mental_illness</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">on_atypical_antipsychotic_medication</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">on_corticosteroids</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Tracking</span> <span class="tok-nx">state</span>

    <span class="tok-nx">total_cholesterol_HDL_ratio</span>: <span class="tok-kt">Real</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Systolic</span> <span class="tok-nx">BP</span> <span class="tok-k">in</span> <span class="tok-p">[</span><span class="tok-nx">mmHg</span><span class="tok-p">],</span> <span class="tok-nx">at</span> <span class="tok-nx">least</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-nx">max</span> <span class="tok-mi">10</span> <span class="tok-nx">samples</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">systolic_BP_history</span>: <span class="tok-kt">Array</span><span class="tok-o">&lt;</span><span class="tok-nx">Real</span><span class="tok-o">&gt;</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">..</span><span class="tok-mi">10</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-nx">systolic_BP_std_deviation</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">{</span><span class="tok-nx">Statistical_evaluator</span><span class="tok-p">}.</span><span class="tok-nx">std_dev</span> <span class="tok-p">(</span><span class="tok-nx">systolic_BP_history</span><span class="tok-p">)</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Applying</span> <span class="tok-nx">the</span> <span class="tok-nx">fractional</span> <span class="tok-nx">polynomial</span> <span class="tok-nx">transforms</span>
    <span class="tok-o">|</span> <span class="tok-p">(</span><span class="tok-nx">which</span> <span class="tok-nx">includes</span> <span class="tok-nx">scaling</span><span class="tok-p">)</span>
    <span class="tok-o">|</span>

    <span class="tok-nx">age_1_centred</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">(</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">age_in_years</span><span class="tok-o">/</span><span class="tok-mi">10</span><span class="tok-p">)</span> <span class="tok-o">^</span> <span class="tok-mf">0.5</span>  <span class="tok-o">-</span> <span class="tok-nx">Age_1_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">centre</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">age_1_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">age_1_centred</span> <span class="tok-o">*</span> <span class="tok-nx">Age_1_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">scale</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">age_2_centred</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">age_in_years</span><span class="tok-o">/</span><span class="tok-mi">10</span> <span class="tok-o">-</span> <span class="tok-nx">Age_2_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">centre</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">age_2_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">age_2_centred</span> <span class="tok-o">*</span> <span class="tok-nx">Age_2_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">scale</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">BMI_scaled</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">BMI</span><span class="tok-p">.</span><span class="tok-nx">BMI</span><span class="tok-o">/</span><span class="tok-mi">10</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">BMI_1_centred</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">BMI_scaled</span> <span class="tok-o">^</span> <span class="tok-mf">0.5</span> <span class="tok-o">-</span> <span class="tok-nx">BMI_1_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">centre</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">BMI_1_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">BMI_1_centred</span> <span class="tok-o">*</span> <span class="tok-nx">BMI_1_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">scale</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">BMI_2_centred</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">BMI_scaled</span> <span class="tok-o">^</span> <span class="tok-mf">0.5</span> <span class="tok-o">*</span> <span class="tok-p">{</span><span class="tok-nx">math</span><span class="tok-p">}.</span><span class="tok-nx">ln</span> <span class="tok-p">(</span><span class="tok-nx">BMI_scaled</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-nx">BMI_2_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">centre</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">BMI_2_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">BMI_2_centred</span> <span class="tok-o">*</span> <span class="tok-nx">BMI_2_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">scale</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">rheumatoid_arthritis_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">(</span><span class="tok-nx">has_rheumatoid_arthritis</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span> <span class="tok-o">-</span> <span class="tok-nx">Rheumatoid_arthritis_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">centre</span><span class="tok-p">])</span>
                    <span class="tok-o">*</span> <span class="tok-nx">Rheumatoid_arthritis_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">scale</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">systolic_BP</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">systolic_BP_history</span><span class="tok-p">.</span><span class="tok-nx">last</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">systolic_BP_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">(</span><span class="tok-nx">systolic_BP</span> <span class="tok-o">-</span> <span class="tok-nx">Systolic_BP_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">centre</span><span class="tok-p">])</span>
                    <span class="tok-o">*</span> <span class="tok-nx">Systolic_BP_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">scale</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">systolic_BP_std_dev_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">(</span><span class="tok-nx">systolic_BP_std_deviation</span> <span class="tok-o">-</span> <span class="tok-nx">Systolic_BP_std_dev_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">centre</span><span class="tok-p">])</span>
                    <span class="tok-o">*</span> <span class="tok-nx">Systolic_BP_std_dev_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">scale</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">townsend_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">(</span><span class="tok-nx">townsend_score</span> <span class="tok-o">-</span> <span class="tok-nx">Townsend_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">centre</span><span class="tok-p">])</span>
                    <span class="tok-o">*</span> <span class="tok-nx">Townsend_stats</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">][</span><span class="tok-nx">scale</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">TODO</span>: <span class="tok-kt">Unclear</span> <span class="tok-nx">what</span> <span class="tok-k">this</span> <span class="tok-nx">is</span> <span class="tok-nx">from</span> <span class="tok-nx">published</span> <span class="tok-nx">algorithm</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">survivor_factor</span>: <span class="tok-kt">Real</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Compute</span> <span class="tok-nx">quantitative</span> <span class="tok-o">&amp;</span> <span class="tok-nx">classified</span> <span class="tok-nx">part</span> <span class="tok-nx">of</span> <span class="tok-nx">score</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">raw_score_1</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">add</span> <span class="tok-p">(</span>
            <span class="tok-nx">Ethnicity_risk_factors</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-nx">qRisk3_ethnicity</span><span class="tok-p">],</span>
            <span class="tok-nx">Smoking_risk_factors</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-nx">smoking_status</span><span class="tok-p">],</span>
            <span class="tok-nx">age_1_score</span><span class="tok-p">,</span>
            <span class="tok-nx">age_2_score</span><span class="tok-p">,</span>
            <span class="tok-nx">BMI_1_score</span><span class="tok-p">,</span>
            <span class="tok-nx">BMI_2_score</span><span class="tok-p">,</span>
            <span class="tok-nx">rheumatoid_arthritis_score</span><span class="tok-p">,</span>
            <span class="tok-nx">systolic_BP_score</span><span class="tok-p">,</span>
            <span class="tok-nx">systolic_BP_std_dev_score</span><span class="tok-p">,</span>
            <span class="tok-nx">townsend_score_score</span><span class="tok-p">,</span>
            <span class="tok-nx">Diabetes_scales</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-nx">diabetes_status</span><span class="tok-p">]</span>
        <span class="tok-p">)</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Compute</span> <span class="tok-kr">boolean</span> <span class="tok-nx">part</span> <span class="tok-nx">of</span> <span class="tok-nx">score</span><span class="tok-p">;</span> <span class="tok-nx">use</span> <span class="tok-nx">vector</span>
    <span class="tok-o">|</span> <span class="tok-k">in</span> <span class="tok-nx">order</span> <span class="tok-nx">to</span> <span class="tok-nx">copmpute</span> <span class="tok-nx">dot</span> <span class="tok-nx">product</span> <span class="tok-kd">with</span> <span class="tok-nx">scales</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">boolean_risks</span>: <span class="tok-kt">Vector</span><span class="tok-o">&lt;</span><span class="tok-nx">Real</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">[</span>
            <span class="tok-nx">has_atrial_fibrillation</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">on_atypical_antipsychotic_medication</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">on_corticosteroids</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_impotence</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_migraines</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_rheumatoid_arthritis</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_chronic_kidney_disease</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_severe_mental_illness</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_systemic_lupus</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">on_hypertension_treatment</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">family_history_CV_disease</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span>
        <span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">raw_score_2</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">boolean_risks</span> <span class="tok-p">.</span> <span class="tok-nx">Risk_factor_scales</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Compute</span> <span class="tok-nx">interaction</span> <span class="tok-nx">part</span> <span class="tok-nx">of</span> <span class="tok-nx">score</span><span class="tok-p">;</span> <span class="tok-nx">use</span> <span class="tok-nx">vector</span>
    <span class="tok-o">|</span> <span class="tok-k">in</span> <span class="tok-nx">order</span> <span class="tok-nx">to</span> <span class="tok-nx">copmpute</span> <span class="tok-nx">dot</span> <span class="tok-nx">product</span> <span class="tok-kd">with</span> <span class="tok-nx">scales</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">interaction_risks</span>: <span class="tok-kt">Vector</span><span class="tok-o">&lt;</span><span class="tok-nx">Real</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">[</span>
            <span class="tok-nx">has_atrial_fibrillation</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">on_corticosteroids</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_impotence</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_migraines</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_chronic_kidney_disease</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">has_systemic_lupus</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">on_hypertension_treatment</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">BMI_1_centred</span><span class="tok-p">,</span>
            <span class="tok-nx">BMI_2_centred</span><span class="tok-p">,</span>
            <span class="tok-nx">family_history_CV_disease</span><span class="tok-p">.</span><span class="tok-nx">as_integer</span><span class="tok-p">,</span>
            <span class="tok-nx">systolic_BP</span><span class="tok-p">,</span>
            <span class="tok-nx">townsend</span>
        <span class="tok-p">]</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">raw_score_3</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">add</span> <span class="tok-p">(</span>
            <span class="tok-nx">age_1_centred</span> <span class="tok-o">*</span> <span class="tok-nx">Smoking_interaction_scales</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">],</span> <span class="tok-nx">smoking_status</span><span class="tok-p">],</span>
            <span class="tok-nx">age_1_centred</span> <span class="tok-o">*</span> <span class="tok-nx">Diabetes_interaction_scales</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">],</span> <span class="tok-nx">diabetes_status</span><span class="tok-p">],</span>

            <span class="tok-nx">age_1_centred</span> <span class="tok-o">*</span> <span class="tok-nx">interaction_risks</span> <span class="tok-p">.</span> <span class="tok-nx">Interaction_scales</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-nx">age_1</span><span class="tok-p">]],</span>

            <span class="tok-nx">age_2_centred</span> <span class="tok-o">*</span> <span class="tok-nx">Smoking_interaction_scales</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">],</span> <span class="tok-nx">smoking_status</span><span class="tok-p">],</span>
            <span class="tok-nx">age_2_centred</span> <span class="tok-o">*</span> <span class="tok-nx">Diabetes_interaction_scales</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">],</span> <span class="tok-nx">diabetes_status</span><span class="tok-p">],</span>

            <span class="tok-nx">age_2_centred</span> <span class="tok-o">*</span> <span class="tok-nx">interaction_risks</span> <span class="tok-p">.</span> <span class="tok-nx">Interaction_scales</span><span class="tok-p">[</span><span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">sex</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-nx">age_2</span><span class="tok-p">]]</span>
        <span class="tok-p">)</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">raw_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">=</span> <span class="tok-nx">raw_score_1</span> <span class="tok-o">+</span> <span class="tok-nx">raw_score_2</span> <span class="tok-o">+</span> <span class="tok-nx">raw_score_3</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Output</span>

    <span class="tok-nx">qRisk3_score</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-mf">100.0</span> <span class="tok-o">*</span> <span class="tok-p">(</span><span class="tok-mi">1</span> <span class="tok-o">-</span> <span class="tok-nx">survivor_factor</span> <span class="tok-o">^</span> <span class="tok-nx">exp</span> <span class="tok-p">(</span><span class="tok-nx">raw_score</span><span class="tok-p">))</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;qRisk_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;QRISK2 score&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;non_smoker&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Non-smoker&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;no_diabetes&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Non-diabetic&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;total_cholesterol_HDL_ratio&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Total cholesterol : HDL ratio&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;TODO: rest of terminology&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;TODO: rest of terminology&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>

        <span class="tok-nx">value_sets</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;diabetes_status&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;diabetes_status&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;no_diabetes&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;type1_diabetes&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;type2_diabetes&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;smoking status&quot;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;status&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;non_smoker&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;ex_smoker&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;light_smoker&quot;</span><span class="tok-p">,</span>
                    <span class="tok-s2">&quot;moderate_smoker&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;heavy_smoker&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_national_early_warning_score_news_2"><a class="anchor" href="#_national_early_warning_score_news_2"></a>11. National Early Warning Score (NEWS) 2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This CPG was developed from the Royal College of Physicians (RCP) <a href="https://www.rcplondon.ac.uk/projects/outputs/national-early-warning-score-news-2" target="_blank" rel="noopener">NEWS2 guideline (2017)</a>.</p>
</div>
<div class="sect2">
<h3 id="_work_plan_4"><a class="anchor" href="#_work_plan_4"></a>11.1. Work Plan</h3>
<div class="paragraph">
<p>The work plan part of NEWS2 is mainly based on the <a href="https://www.rcplondon.ac.uk/file/9437/download" target="_blank" rel="noopener">clinical response</a> part of the guideline, reproduced below.</p>
</div>
<div id="news2_clinical_response" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/images/NEWS2-clinical_response.png" alt="NEWS2 clinical response">
</div>
<div class="title">Figure 7. NEWS2 clinical response</div>
</div>
<div class="paragraph tbd">
<p>TODO: Work Plan</p>
</div>
</div>
<div class="sect2">
<h3 id="_decision_logic_module_5"><a class="anchor" href="#_decision_logic_module_5"></a>11.2. Decision Logic Module</h3>
<div class="paragraph">
<p>The decision logic part of NEWS2 is mainly based on the <a href="https://www.rcplondon.ac.uk/file/9434/download" target="_blank" rel="noopener">NEWS2 score</a> and triggers parts of the guideline, reproduced below.</p>
</div>
<div id="news2_score" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/images/NEWS2-score.png" alt="NEWS2 score">
</div>
<div class="title">Figure 8. NEWS2 score</div>
</div>
<div id="news2_thresholds_triggers" class="imageblock text-center text-center">
<div class="content">
<img src="process_examples/images/NEWS2-thresholds_triggers.png" alt="NEWS2 thresholds triggers">
</div>
<div class="title">Figure 9. NEWS2 thresholds and triggers</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">NEWS2</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Thomas Beale&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;thomas.beale@openEHR.org&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">organisation</span><span class="tok-o">:</span>   <span class="tok-s2">&quot;openEHR Internaitonal &lt;https://www.openEHR.org&gt;&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">date</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;2021-03-01&quot;</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">details</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                    <span class="tok-nx">purpose</span><span class="tok-o">:</span> <span class="tok-s2">&quot;We recommend that the NEWS is used to improve the following:</span>
<span class="tok-s2">                                  i the assessment of acute-illness severity</span>
<span class="tok-s2">                                 ii the detection of clinical deterioration</span>
<span class="tok-s2">                                iii the initiation of a timely and competent clinical response.&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">use</span><span class="tok-o">:</span>     <span class="tok-s2">&quot;NEWS2 should be used to standardise the assessment of acute-illness severity</span>
<span class="tok-s2">                              when patients present acutely to hospital and in prehospital assessment,</span>
<span class="tok-s2">                              ie by the ambulance services.</span>
<span class="tok-s2">                              NEWS should also be used in emergency departments and as a surveillance system</span>
<span class="tok-s2">                              for all patients in hospitals, to track their clinical condition, alert the</span>
<span class="tok-s2">                              clinical team to any clinical deterioration and trigger a timely clinical</span>
<span class="tok-s2">                              response.&quot;</span><span class="tok-p">,</span>
                    <span class="tok-nx">misuse</span><span class="tok-o">:</span>  <span class="tok-s2">&quot;NEWS should not be used in children (ie aged &lt;16 years) or in women who are</span>
<span class="tok-s2">                             pregnant, because the physiological response to acute illness can be modified</span>
<span class="tok-s2">                             in children and by pregnancy. The NEWS may be unreliable in patients with</span>
<span class="tok-s2">                             spinal cord injury (especially tetraplegia or high-level paraplegia),</span>
<span class="tok-s2">                             owing to functional disturbances of the autonomic nervous system.</span>
<span class="tok-s2">                             Use with caution.&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">copyright</span><span class="tok-o">:</span>  <span class="tok-s2">&quot;© 2021 openEHR Foundation&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">licence</span><span class="tok-o">:</span>    <span class="tok-s2">&quot;Creative Commons CC-BY &lt;https://creativecommons.org/licenses/by/3.0/&gt;&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">ip_acknowledgements</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;RCP&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Reproduced from: Royal College of Physicians. National Early Warning Score (NEWS) 2:</span>
<span class="tok-s2">                        Standardising the assessment of acute-illness severity in the NHS. Updated report of</span>
<span class="tok-s2">                        a working party. London. © Royal College of Physicians 2017.</span>
<span class="tok-s2">                        See https://www.rcplondon.ac.uk/projects/outputs/national-early-warning-score-news-2&quot;</span>
            <span class="tok-p">},</span>
            <span class="tok-nx">references</span><span class="tok-o">:</span> <span class="tok-p">[</span>
                <span class="tok-s2">&quot;xxxx.&quot;</span>
            <span class="tok-p">]</span>
        <span class="tok-p">}</span>
        <span class="tok-p">;</span>

<span class="tok-nx">use</span>
    <span class="tok-nx">BASIC</span>: <span class="tok-kt">Basic_patient_data</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Historic</span> <span class="tok-nx">State</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">True</span> <span class="tok-k">if</span> <span class="tok-nx">subject</span> <span class="tok-nx">has</span> <span class="tok-nx">a</span> <span class="tok-nx">normal</span> <span class="tok-nx">target</span> <span class="tok-nx">SpO2</span><span class="tok-p">,</span> <span class="tok-nx">e</span><span class="tok-p">.</span><span class="tok-nx">g</span><span class="tok-p">.</span> <span class="tok-nx">not</span> <span class="tok-k">in</span> <span class="tok-nx">hypercapnic</span>
    <span class="tok-o">|</span> <span class="tok-nx">respiratory</span> <span class="tok-nx">failure</span> <span class="tok-nx">or</span> <span class="tok-nx">similar</span> <span class="tok-nx">condition</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_normal_target_oxygen_sat</span>: <span class="tok-kt">Boolean</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Tracked</span> <span class="tok-nx">State</span>

    <span class="tok-nx">pulse</span>: <span class="tok-kt">Count</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-nx">hr</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Systolic</span> <span class="tok-nx">BP</span> <span class="tok-p">(</span><span class="tok-nx">mmHg</span><span class="tok-p">)</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">systolic_BP</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-nx">hr</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Oxygen</span> <span class="tok-nx">saturation</span> <span class="tok-o">%</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">SpO2</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-nx">hr</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">respiratory_rate</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-nx">hr</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Core</span> <span class="tok-nx">temperature</span> <span class="tok-k">in</span> <span class="tok-nx">deg</span> <span class="tok-nx">C</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">temperature</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-nx">hr</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-p">[</span><span class="tok-nx">air</span><span class="tok-p">]</span> <span class="tok-o">|</span> <span class="tok-p">[</span><span class="tok-nx">oxygen</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">gases</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">gases</span><span class="tok-err">»</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-nx">hr</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-p">[</span><span class="tok-nx">alert</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-nx">normally</span> <span class="tok-nx">alert</span>
    <span class="tok-o">|</span> <span class="tok-p">[</span><span class="tok-nx">CVPU</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-k">new</span> <span class="tok-nx">confusion</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">conscious_state</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">conscious_state</span><span class="tok-err">»</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-nx">hr</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-nx">respiratory_rate_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">respiratory_rate</span> <span class="tok-k">in</span>
            <span class="tok-o">==============</span>
            <span class="tok-o">|</span><span class="tok-err">≤</span><span class="tok-mi">8</span><span class="tok-o">|:</span>       <span class="tok-mi">3</span><span class="tok-p">,</span>
            <span class="tok-o">--------------</span>
            <span class="tok-o">|</span><span class="tok-mi">9</span><span class="tok-p">..</span><span class="tok-mi">11</span><span class="tok-o">|:</span>    <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">--------------</span>
            <span class="tok-o">|</span><span class="tok-mi">12</span><span class="tok-p">..</span><span class="tok-mi">20</span><span class="tok-o">|:</span>   <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">--------------</span>
            <span class="tok-o">|</span><span class="tok-mi">21</span><span class="tok-p">..</span><span class="tok-mi">24</span><span class="tok-o">|:</span>   <span class="tok-mi">2</span><span class="tok-p">,</span>
            <span class="tok-o">--------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">25</span><span class="tok-o">|:</span>      <span class="tok-mi">3</span>
            <span class="tok-o">==============</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Scale</span> <span class="tok-mi">1</span> <span class="tok-nx">is</span> <span class="tok-nx">used</span> <span class="tok-kd">with</span> <span class="tok-nx">most</span> <span class="tok-nx">patients</span><span class="tok-p">,</span> <span class="tok-nx">except</span> <span class="tok-nx">those</span> <span class="tok-kd">with</span> <span class="tok-nx">a</span> <span class="tok-nx">lowered</span> <span class="tok-nx">target</span> <span class="tok-nx">SpO2</span><span class="tok-p">,</span>
    <span class="tok-o">|</span> <span class="tok-k">for</span> <span class="tok-nx">whom</span> <span class="tok-nx">the</span> <span class="tok-nx">scale</span> <span class="tok-mi">2</span> <span class="tok-nx">form</span> <span class="tok-nx">of</span> <span class="tok-nx">scoring</span> <span class="tok-nx">should</span> <span class="tok-nx">be</span> <span class="tok-nx">used</span><span class="tok-p">.</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">SpO2_score_1</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">SpO2</span> <span class="tok-k">in</span>
            <span class="tok-o">==============</span>
            <span class="tok-o">|</span><span class="tok-err">≤</span><span class="tok-mi">91</span><span class="tok-o">|:</span>      <span class="tok-mi">3</span><span class="tok-p">,</span>
            <span class="tok-o">--------------</span>
            <span class="tok-o">|</span><span class="tok-mi">92</span><span class="tok-p">..</span><span class="tok-mi">93</span><span class="tok-o">|:</span>   <span class="tok-mi">2</span><span class="tok-p">,</span>
            <span class="tok-o">--------------</span>
            <span class="tok-o">|</span><span class="tok-mi">94</span><span class="tok-p">..</span><span class="tok-mi">95</span><span class="tok-o">|:</span>   <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">--------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">96</span><span class="tok-o">|:</span>      <span class="tok-mi">0</span>
            <span class="tok-o">==============</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Scale</span> <span class="tok-mi">2</span> <span class="tok-nx">is</span> <span class="tok-nx">used</span> <span class="tok-nx">only</span> <span class="tok-k">for</span> <span class="tok-nx">patients</span> <span class="tok-kd">with</span> <span class="tok-nx">oxygen</span> <span class="tok-nx">saturation</span> <span class="tok-p">(</span><span class="tok-nx">SpO2</span><span class="tok-p">)</span>
    <span class="tok-o">|</span> <span class="tok-nx">target</span> <span class="tok-nx">range</span> <span class="tok-nx">of</span> <span class="tok-mi">88</span><span class="tok-err">–</span><span class="tok-mi">92</span><span class="tok-o">%</span><span class="tok-p">,</span> <span class="tok-nx">such</span> <span class="tok-kr">as</span> <span class="tok-nx">patients</span> <span class="tok-kd">with</span> <span class="tok-nx">hypercapnic</span>
    <span class="tok-o">|</span> <span class="tok-nx">respiratory</span> <span class="tok-nx">failure</span> <span class="tok-p">(</span><span class="tok-nx">e</span><span class="tok-p">.</span><span class="tok-nx">g</span><span class="tok-p">.</span> <span class="tok-nx">due</span> <span class="tok-nx">to</span> <span class="tok-nx">COPD</span><span class="tok-p">).</span> <span class="tok-nx">This</span> <span class="tok-nx">score</span> <span class="tok-nx">is</span> <span class="tok-nx">partly</span>
    <span class="tok-o">|</span> <span class="tok-nx">conditional</span> <span class="tok-nx">on</span> <span class="tok-nx">which</span> <span class="tok-nx">gases</span> <span class="tok-nx">are</span> <span class="tok-nx">being</span> <span class="tok-nx">administered</span><span class="tok-p">.</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">SpO2_score_2</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">============================================</span>
            <span class="tok-nx">SpO2</span> <span class="tok-err">≤</span> <span class="tok-nx">92</span>:  <span class="tok-kt">case</span> <span class="tok-nx">SpO2</span> <span class="tok-k">in</span>
                <span class="tok-o">==============</span>
                <span class="tok-o">|</span><span class="tok-err">≤</span><span class="tok-mi">83</span><span class="tok-o">|:</span>      <span class="tok-mi">3</span><span class="tok-p">,</span>
                <span class="tok-o">--------------</span>
                <span class="tok-o">|</span><span class="tok-mi">84</span><span class="tok-p">..</span><span class="tok-mi">85</span><span class="tok-o">|:</span>   <span class="tok-mi">2</span><span class="tok-p">,</span>
                <span class="tok-o">--------------</span>
                <span class="tok-o">|</span><span class="tok-mi">86</span><span class="tok-p">..</span><span class="tok-mi">87</span><span class="tok-o">|:</span>   <span class="tok-mi">1</span><span class="tok-p">,</span>
                <span class="tok-o">--------------</span>
                <span class="tok-o">|</span><span class="tok-mi">88</span><span class="tok-p">..</span><span class="tok-mi">92</span><span class="tok-o">|:</span>   <span class="tok-mi">0</span>
                <span class="tok-o">==============</span>
                <span class="tok-p">;,</span>
            <span class="tok-o">--------------------------------------------</span>
            <span class="tok-nx">SpO2</span> <span class="tok-err">≥</span> <span class="tok-mi">93</span> <span class="tok-nx">and</span> <span class="tok-nx">gases</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">air</span><span class="tok-p">]</span><span class="tok-o">:</span>
                <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">--------------------------------------------</span>
            <span class="tok-nx">SpO2</span> <span class="tok-err">≥</span> <span class="tok-mi">93</span> <span class="tok-nx">and</span> <span class="tok-nx">gases</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">oxygen</span><span class="tok-p">]</span><span class="tok-o">:</span> <span class="tok-k">case</span> <span class="tok-nx">SpO2</span> <span class="tok-k">in</span>
                <span class="tok-o">==============</span>
                <span class="tok-o">|</span><span class="tok-mi">93</span><span class="tok-p">..</span><span class="tok-mi">94</span><span class="tok-o">|:</span>   <span class="tok-mi">1</span><span class="tok-p">,</span>
                <span class="tok-o">--------------</span>
                <span class="tok-o">|</span><span class="tok-mi">95</span><span class="tok-p">..</span><span class="tok-mi">96</span><span class="tok-o">|:</span>   <span class="tok-mi">2</span><span class="tok-p">,</span>
                <span class="tok-o">--------------</span>
                <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">97</span><span class="tok-o">|:</span>      <span class="tok-mi">3</span>
                <span class="tok-o">==============</span>
                <span class="tok-p">;</span>
            <span class="tok-o">============================================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">SpO2_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">has_normal_target_oxygen_sat</span> <span class="tok-o">?</span> <span class="tok-nx">SpO2_score_1</span> : <span class="tok-kt">SpO2_score_2</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">gases_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">gases</span> <span class="tok-k">in</span>
            <span class="tok-o">==============</span>
            <span class="tok-p">[</span><span class="tok-nx">air</span><span class="tok-p">]</span><span class="tok-o">:</span>     <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">--------------</span>
            <span class="tok-p">[</span><span class="tok-nx">oxygen</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-mi">2</span>
            <span class="tok-o">==============</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">systolic_BP_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">systolic_BP</span> <span class="tok-k">in</span>
            <span class="tok-o">================</span>
            <span class="tok-o">|</span><span class="tok-err">≤</span><span class="tok-mi">90</span><span class="tok-o">|:</span>        <span class="tok-mi">3</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-mi">91</span><span class="tok-p">..</span><span class="tok-mi">100</span><span class="tok-o">|:</span>    <span class="tok-mi">2</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-mi">101</span><span class="tok-p">..</span><span class="tok-mi">110</span><span class="tok-o">|:</span>   <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-mi">111</span><span class="tok-p">..</span><span class="tok-mi">219</span><span class="tok-o">|:</span>   <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">220</span><span class="tok-o">|:</span>       <span class="tok-mi">3</span>
            <span class="tok-o">================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">pulse_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">pulse</span> <span class="tok-k">in</span>
            <span class="tok-o">================</span>
            <span class="tok-o">|</span><span class="tok-err">≤</span><span class="tok-mi">40</span><span class="tok-o">|:</span>        <span class="tok-mi">3</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-mi">41</span><span class="tok-p">..</span><span class="tok-mi">50</span><span class="tok-o">|:</span>     <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-mi">51</span><span class="tok-p">..</span><span class="tok-mi">90</span><span class="tok-o">|:</span>     <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-mi">91</span><span class="tok-p">..</span><span class="tok-mi">110</span><span class="tok-o">|:</span>    <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-mi">111</span><span class="tok-p">..</span><span class="tok-mi">130</span><span class="tok-o">|:</span>   <span class="tok-mi">2</span><span class="tok-p">,</span>
            <span class="tok-o">----------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">131</span><span class="tok-o">|:</span>       <span class="tok-mi">3</span>
            <span class="tok-o">================</span>
        <span class="tok-p">;</span>

    <span class="tok-nx">temperature_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">temperature</span> <span class="tok-k">in</span>
            <span class="tok-o">=================</span>
            <span class="tok-o">|</span><span class="tok-err">≤</span><span class="tok-mf">35.0</span><span class="tok-o">|:</span>       <span class="tok-mi">3</span><span class="tok-p">,</span>
            <span class="tok-o">-----------------</span>
            <span class="tok-o">|</span><span class="tok-mf">35.1</span><span class="tok-p">..</span><span class="tok-mf">36.0</span><span class="tok-o">|:</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">-----------------</span>
            <span class="tok-o">|</span><span class="tok-mf">36.1</span><span class="tok-p">..</span><span class="tok-mf">38.0</span><span class="tok-o">|:</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>
            <span class="tok-o">-----------------</span>
            <span class="tok-o">|</span><span class="tok-mf">38.1</span><span class="tok-p">..</span><span class="tok-mf">39.0</span><span class="tok-o">|:</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-o">-----------------</span>
            <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mf">39.1</span><span class="tok-o">|:</span>       <span class="tok-mi">2</span>
            <span class="tok-o">=================</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Output</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Generate</span> <span class="tok-nx">NEWS2</span> <span class="tok-nx">score</span><span class="tok-p">,</span> <span class="tok-nx">taking</span> <span class="tok-nx">into</span> <span class="tok-nx">account</span> <span class="tok-nx">variation</span> <span class="tok-k">in</span> <span class="tok-nx">target</span> <span class="tok-nx">O2</span> <span class="tok-nx">saturation</span><span class="tok-p">,</span>
    <span class="tok-o">|</span> <span class="tok-k">for</span> <span class="tok-nx">which</span> <span class="tok-nx">two</span> <span class="tok-nx">SpO2</span> <span class="tok-nx">scoring</span> <span class="tok-nx">scales</span> <span class="tok-nx">are</span> <span class="tok-nx">used</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">NEWS2_score</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span><span class="tok-p">.</span><span class="tok-nx">add</span> <span class="tok-p">(</span>
            <span class="tok-o">------------------</span>
            <span class="tok-nx">respiratory_score</span><span class="tok-p">,</span>
            <span class="tok-nx">SpO2_score</span><span class="tok-p">,</span>
            <span class="tok-nx">gases_score</span><span class="tok-p">,</span>
            <span class="tok-nx">systolic_BP_score</span><span class="tok-p">,</span>
            <span class="tok-nx">pulse_score</span><span class="tok-p">,</span>
            <span class="tok-nx">temperature_score</span>
            <span class="tok-o">------------------</span>
        <span class="tok-p">)</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Has</span> <span class="tok-nx">a</span> <span class="tok-nx">score</span> <span class="tok-nx">of</span> <span class="tok-mi">3</span> <span class="tok-k">in</span> <span class="tok-nx">any</span> <span class="tok-nx">individual</span> <span class="tok-nx">parameter</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">has_red_score</span>: <span class="tok-kt">Boolean</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span>
            <span class="tok-nx">respiratory_score</span> <span class="tok-o">=</span> <span class="tok-mi">3</span> <span class="tok-nx">or</span>
            <span class="tok-nx">SpO2_score</span> <span class="tok-o">=</span> <span class="tok-mi">3</span> <span class="tok-nx">or</span>
            <span class="tok-nx">gases_score</span> <span class="tok-o">=</span> <span class="tok-mi">3</span> <span class="tok-nx">or</span>
            <span class="tok-nx">systolic_BP_score</span> <span class="tok-o">=</span> <span class="tok-mi">3</span> <span class="tok-nx">or</span>
            <span class="tok-nx">pulse_score</span> <span class="tok-o">=</span> <span class="tok-mi">3</span> <span class="tok-nx">or</span>
            <span class="tok-nx">temperature_score</span> <span class="tok-o">=</span> <span class="tok-mi">3</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Generate</span> <span class="tok-nx">a</span> <span class="tok-nx">clinical</span> <span class="tok-nx">risk</span> <span class="tok-nx">classification</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">clinical_risk</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">NEWS2_clinical_risk</span><span class="tok-err">»</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">========================================</span>
            <span class="tok-nx">NEWS2_score</span> <span class="tok-k">in</span> <span class="tok-o">|</span><span class="tok-mi">0</span><span class="tok-p">..</span><span class="tok-mi">4</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">low</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------</span>
            <span class="tok-nx">has_red_score</span><span class="tok-o">:</span>          <span class="tok-p">[</span><span class="tok-nx">low_to_medium</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------</span>
            <span class="tok-nx">NEWS2_score</span> <span class="tok-k">in</span> <span class="tok-o">|</span><span class="tok-mi">5</span><span class="tok-p">..</span><span class="tok-mi">6</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">medium</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------</span>
            <span class="tok-nx">NEWS2_score</span> <span class="tok-err">≥</span><span class="tok-mi">7</span><span class="tok-o">:</span>         <span class="tok-p">[</span><span class="tok-nx">high</span><span class="tok-p">]</span>
            <span class="tok-o">========================================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Convert</span> <span class="tok-nx">score</span> <span class="tok-nx">to</span> <span class="tok-nx">a</span> <span class="tok-nx">clinical</span> <span class="tok-nx">response</span> <span class="tok-nx">band</span>
    <span class="tok-o">|</span> <span class="tok-nx">NB</span>: <span class="tok-kt">tese</span> <span class="tok-nx">band</span> <span class="tok-nx">names</span> <span class="tok-nx">are</span> <span class="tok-nx">not</span> <span class="tok-nx">explicit</span> <span class="tok-k">in</span> <span class="tok-nx">the</span> <span class="tok-nx">published</span> <span class="tok-nx">NEWS2</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">clinical_response_band</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">NEWS2_clinical_response_band</span><span class="tok-err">»</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">=======================================</span>
            <span class="tok-nx">NEWS2_score</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">:</span>        <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_1</span><span class="tok-p">],</span>
            <span class="tok-o">---------------------------------------</span>
            <span class="tok-nx">NEWS2_score</span> <span class="tok-k">in</span> <span class="tok-o">|</span><span class="tok-mi">1</span><span class="tok-p">..</span><span class="tok-mi">4</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_2</span><span class="tok-p">],</span>
            <span class="tok-o">---------------------------------------</span>
            <span class="tok-nx">has_red_score</span><span class="tok-o">:</span>          <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_3</span><span class="tok-p">],</span>
            <span class="tok-o">---------------------------------------</span>
            <span class="tok-nx">NEWS2_score</span> <span class="tok-k">in</span> <span class="tok-o">|</span><span class="tok-mi">5</span><span class="tok-p">..</span><span class="tok-mi">6</span><span class="tok-o">|:</span>  <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_4</span><span class="tok-p">],</span>
            <span class="tok-o">---------------------------------------</span>
            <span class="tok-nx">NEWS2_score</span> <span class="tok-k">in</span> <span class="tok-o">|</span><span class="tok-err">≥</span><span class="tok-mi">7</span><span class="tok-o">|:</span>    <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_5</span><span class="tok-p">]</span>
            <span class="tok-o">=======================================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Generate</span> <span class="tok-nx">a</span> <span class="tok-nx">monitoring</span> <span class="tok-nx">classification</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">clinical_monitoring</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">NEWS2_clinical_monitoring</span><span class="tok-err">»</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-k">case</span> <span class="tok-nx">clinical_response_band</span> <span class="tok-k">in</span>
            <span class="tok-o">====================================================</span>
            <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_1</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-p">[</span><span class="tok-nx">minimum_12_hourly_monitoring</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_2</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-p">[</span><span class="tok-nx">minimum_4_to_6_hourly_monitoring</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_3</span><span class="tok-p">],</span>
            <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_4</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-p">[</span><span class="tok-nx">minimum_1_hourly_monitoring</span><span class="tok-p">],</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-p">[</span><span class="tok-nx">NEWS2_band_5</span><span class="tok-p">]</span><span class="tok-o">:</span>  <span class="tok-p">[</span><span class="tok-nx">continuous_monitoring</span><span class="tok-p">]</span>
            <span class="tok-o">====================================================</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;pulse&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Pulse&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;systolic_BP&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;systolic blood pressure in mmHg&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;SpO2&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Oxygen saturation&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;respiratory_rate&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Respiratory rate&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;temperature&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Core temperature&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;gases&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Gases being adminsitered to subject&quot;</span>
                <span class="tok-p">},</span>

                <span class="tok-s2">&quot;pulse_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Pulse component of NEWS2 score&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;systolic_BP_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;systolic blood pressure component of NEWS2 score&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;SpO2_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Oxygen saturation component of NEWS2 score&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;respiratory_rate_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Respiratory rate component of NEWS2 score&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;gases_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Gases component of NEWS2 score&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;temperature_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Temperature component of NEWS2 score&quot;</span>
                <span class="tok-p">},</span>

                <span class="tok-s2">&quot;NEWS2_score&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;NEWS2 score&quot;</span>
                <span class="tok-p">},</span>

                <span class="tok-s2">&quot;oxygen&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;subject on positive-pressure oxygen&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;air&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;subject on positive-pressure air&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;alert&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Subject is alert&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;CVPU&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;New confusion (C) or no response to voice (V), pain (P) or is unresponsive (U)&quot;</span>
                <span class="tok-p">},</span>

                <span class="tok-s2">&quot;low&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;low risk&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;low_to_medium&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;low_to_medium risk&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;medium&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;medium risk&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;high&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;high risk&quot;</span>
                <span class="tok-p">},</span>

                <span class="tok-s2">&quot;minimum_12_hourly_monitoring&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;minimum 12 hourly monitoring&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;minimum_4_to_6_hourly_monitoring&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;minimum 4-6 hourly monitoring&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;minimum_1_hourly_monitoring&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;minimum 1 hourly monitoring&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;continuous_monitoring&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;continuous monitoring&quot;</span>
                <span class="tok-p">}</span>

            <span class="tok-p">}</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">value_sets</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;conscious_state&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;conscious_state&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;alert&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;CVPU&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;gases&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;gases&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;air&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;oxygen&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;NEWS2_clinical_risk&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;NEWS2_clinical_risk&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;low&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;low_to_medium&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;medium&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;high&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;NEWS2_clinical_monitoring&quot;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;NEWS2_clinical_monitoring&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;minimum_12_hourly_monitoring&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;minimum_4_to_6_hourly_monitoring&quot;</span><span class="tok-p">,</span>
                           <span class="tok-s2">&quot;minimum_1_hourly_monitoring&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;continuous_monitoring&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;NEWS2_clinical_response_band&quot;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;NEWS2_clinical_response_band&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;NEWS2_band_1&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;NEWS2_band_2&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;NEWS2_band_3&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;NEWS2_band_4&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;NEWS2_band_5&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bindings_2"><a class="anchor" href="#_bindings_2"></a>11.3. Bindings</h3>
<div class="paragraph">
<p>The following defines the logical bindings of DLM variables to back-end data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--
-- Demographic items: AQL query
--
SELECT
    OBS/data[at0001]/events[at0002]/data[at0003]/items[at0004] AS date_of_birth,
    OBS/data[at0001]/events[at0002]/data[at0003]/items[at0008] AS sex
    C/context/start_time AS time
FROM
    EHR e[ehr_id/value=$ehrUid]
        CONTAINS COMPOSITION C
        CONTAINS OBSERVATION OBS[openEHR-EHR-OBSERVATION.basic_demographic.v1]
ORDER BY
    time DESC


--
-- CHA2DS2-VASc input items
--
SELECT
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0026] AS has_congestive_heart_failure,
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0029] AS has_hypertension,
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0039] AS has_stroke_TIA_thromboembolism,
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0046] AS has_vascular_disease,
    OBS/data[at0002]/events[at0003]/data[at0001]/items[at0032] AS has_diabetes,
    C/context/start_time AS time
FROM
    EHR e[ehr_id/value=$ehrUid]
        CONTAINS COMPOSITION C
        CONTAINS OBSERVATION OBS[openEHR-EHR-OBSERVATION.chadsvasc_score.v1]
ORDER BY
    time DESC</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_decision_logic_modules"><a class="anchor" href="#_common_decision_logic_modules"></a>12. Common Decision Logic Modules</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_basic_demographics"><a class="anchor" href="#_basic_demographics"></a>12.1. BASIC: Demographics</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">BASIC</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
        <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Thomas Beale&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;thomas.beale@openEHR.org&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">organisation</span><span class="tok-o">:</span>   <span class="tok-s2">&quot;openEHR Foundation &lt;http://www.openEHR.org&gt;&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">date</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;2021-01-10&quot;</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">details</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                <span class="tok-nx">purpose</span><span class="tok-o">:</span> <span class="tok-s2">&quot;To access common demographic state.&quot;</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">Administrative</span>

    <span class="tok-nx">date_of_birth</span>: <span class="tok-kt">Date</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">sex</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">male</span><span class="tok-p">]</span> <span class="tok-o">|</span> <span class="tok-p">[</span><span class="tok-nx">female</span><span class="tok-p">]</span> <span class="tok-o">|</span> <span class="tok-p">[</span><span class="tok-nx">indeterminate</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">sex</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">sexes</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">race</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">race</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">races</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Ethnicity</span><span class="tok-o">:</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">white_or_not_stated</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">indian</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">pakistani</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">bangladeshi</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">other_asian</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">black_caribbean</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">black_african</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>   <span class="tok-p">[</span><span class="tok-nx">other_ethnic_group</span><span class="tok-p">]</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">ethnicity</span>: <span class="tok-kt">Terminology_code</span> <span class="tok-err">«</span><span class="tok-nx">ethnicities</span><span class="tok-err">»</span><span class="tok-p">,</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">age</span> <span class="tok-k">in</span> <span class="tok-nx">years</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">age_in_years</span>: <span class="tok-kt">Integer</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">(</span><span class="tok-nx">current_date</span> <span class="tok-o">-</span> <span class="tok-nx">date_of_birth</span><span class="tok-p">).</span><span class="tok-nx">as_years</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;date_of_birth&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Date of birth&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;age&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Age&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;age_in_years&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Age in years&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;sex&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Sex&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;male&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Male sex&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;female&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Female sex&quot;</span>
                <span class="tok-p">},</span>
            <span class="tok-p">},</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">value_sets</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;sexes&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;sexes&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;male&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;female&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;indeterminate&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;ethnicities&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;ethnicities&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;white&quot;</span><span class="tok-p">,</span>
                    <span class="tok-s2">&quot;indian&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;pakistani&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;bangladeshi&quot;</span><span class="tok-p">,</span>
                    <span class="tok-s2">&quot;other_asian&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;black_caribbean&quot;</span><span class="tok-p">,</span>
                    <span class="tok-s2">&quot;black_african&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;other_ethnic_group&quot;</span>
                <span class="tok-p">]</span>
            <span class="tok-p">},</span>
            <span class="tok-s2">&quot;races&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-s2">&quot;races&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">members</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;caucasian&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;asian&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;black&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;other&quot;</span><span class="tok-p">]</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bsa_body_surface_area"><a class="anchor" href="#_bsa_body_surface_area"></a>12.2. BSA: Body Surface Area</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">Body_surface_area</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
        <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Thomas Beale&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;thomas.beale@openEHR.org&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">organisation</span><span class="tok-o">:</span>   <span class="tok-s2">&quot;openEHR Foundation &lt;http://www.openEHR.org&gt;&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">date</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;2021-01-10&quot;</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">details</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                <span class="tok-nx">purpose</span><span class="tok-o">:</span>  <span class="tok-s2">&quot;Body surface area.&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">use</span><span class="tok-o">:</span>      <span class="tok-s2">&quot;Used to calculate dosage e.g. for chemotherapy and other systemic medications.&quot;</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">State</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Weight</span> <span class="tok-kr">as</span> <span class="tok-nx">recorded</span> <span class="tok-k">in</span> <span class="tok-nx">local</span> <span class="tok-nx">system</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">weight</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">30</span><span class="tok-nx">d</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Height</span> <span class="tok-kr">as</span> <span class="tok-nx">recorded</span> <span class="tok-k">in</span> <span class="tok-nx">local</span> <span class="tok-nx">system</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">height</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-nx">y</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Weight</span> <span class="tok-k">in</span> <span class="tok-nx">kg</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">weight_in_kg</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">=====================================================</span>
            <span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">units</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;kg&quot;</span><span class="tok-o">:</span>    <span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">magnitude</span><span class="tok-p">,</span>
            <span class="tok-o">-----------------------------------------------------</span>
            <span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">units</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;lb&quot;</span><span class="tok-o">:</span>    <span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">magnitude</span> <span class="tok-o">/</span> <span class="tok-mf">2.2</span><span class="tok-p">,</span>
            <span class="tok-o">-----------------------------------------------------</span>
            <span class="tok-o">*:</span>                      <span class="tok-p">{</span><span class="tok-nx">Quantity_converter</span><span class="tok-p">}.</span>
                                    <span class="tok-nx">convert_value</span> <span class="tok-p">(</span><span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">value</span><span class="tok-p">,</span>
                                        <span class="tok-nx">from</span>: <span class="tok-kt">weight.units</span><span class="tok-p">,</span>
                                        <span class="tok-nx">to</span><span class="tok-o">:</span> <span class="tok-s2">&quot;kg&quot;</span><span class="tok-p">,</span>
                                        <span class="tok-nx">UCUM</span><span class="tok-p">.[</span><span class="tok-nx">mass</span><span class="tok-p">])</span>
            <span class="tok-o">=====================================================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Height</span> <span class="tok-k">in</span> <span class="tok-nx">cm</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">height_in_cm</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">====================================================</span>
            <span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">units</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;cm&quot;</span><span class="tok-o">:</span>    <span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">magnitude</span><span class="tok-p">,</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">units</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;m&quot;</span><span class="tok-o">:</span>     <span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">magnitude</span> <span class="tok-o">*</span> <span class="tok-mi">100</span><span class="tok-p">,</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-o">*:</span>                      <span class="tok-p">{</span><span class="tok-nx">Quantity_converter</span><span class="tok-p">}.</span>
                                    <span class="tok-nx">convert_value</span> <span class="tok-p">(</span><span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">value</span><span class="tok-p">,</span>
                                        <span class="tok-nx">from</span>: <span class="tok-kt">height.units</span><span class="tok-p">,</span>
                                        <span class="tok-nx">to</span><span class="tok-o">:</span> <span class="tok-s2">&quot;cm&quot;</span><span class="tok-p">,</span>
                                        <span class="tok-nx">UCUM</span><span class="tok-p">.[</span><span class="tok-nx">length</span><span class="tok-p">])</span>
            <span class="tok-o">=====================================================</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Output</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Body</span> <span class="tok-nx">surface</span> <span class="tok-nx">area</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">BSA</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-p">{</span><span class="tok-nx">math</span><span class="tok-p">}.</span><span class="tok-nx">sqrt</span> <span class="tok-p">(</span><span class="tok-nx">weight_in_kg</span> <span class="tok-o">*</span> <span class="tok-nx">height_in_cm</span> <span class="tok-o">/</span> <span class="tok-mi">3600</span><span class="tok-p">)</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;bsa&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body surface area&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;weight&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body weight, in whatever units are in local use&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;height&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body height, in whatever units are in local use&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;weight_in_kg&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body weight in kg&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;height_in_cm&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body height in cm&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bmi_body_mass_index"><a class="anchor" href="#_bmi_body_mass_index"></a>12.3. BMI: Body Mass Index</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ts"><span></span><span class="tok-nx">dlm</span> <span class="tok-nx">Body_mass_index</span><span class="tok-p">.</span><span class="tok-nx">v0</span><span class="tok-p">.</span><span class="tok-mf">5.0</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Descriptive</span>

    <span class="tok-nx">language</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">original_language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">]</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span>

    <span class="tok-nx">description</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">lifecycle_state</span><span class="tok-o">:</span> <span class="tok-s2">&quot;unmanaged&quot;</span><span class="tok-p">,</span>
        <span class="tok-nx">original_author</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-nx">name</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;Thomas Beale&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">email</span><span class="tok-o">:</span>          <span class="tok-s2">&quot;thomas.beale@openEHR.org&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">organisation</span><span class="tok-o">:</span>   <span class="tok-s2">&quot;openEHR Foundation &lt;http://www.openEHR.org&gt;&quot;</span><span class="tok-p">,</span>
            <span class="tok-nx">date</span><span class="tok-o">:</span>           <span class="tok-s2">&quot;2021-01-10&quot;</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">details</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-nx">language</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-nx">ISO_639</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">::</span><span class="tok-nx">en</span><span class="tok-p">],</span>
                <span class="tok-nx">purpose</span><span class="tok-o">:</span>  <span class="tok-s2">&quot;Body mass index.&quot;</span><span class="tok-p">,</span>
                <span class="tok-nx">use</span><span class="tok-o">:</span>      <span class="tok-s2">&quot;Used as a rough surrogate for determining whether a</span>
<span class="tok-s2">                          person has in the normal weight range for their height.&quot;</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span>

<span class="tok-nx">input</span> <span class="tok-o">--</span> <span class="tok-nx">State</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Weight</span> <span class="tok-kr">as</span> <span class="tok-nx">recorded</span> <span class="tok-k">in</span> <span class="tok-nx">local</span> <span class="tok-nx">system</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">weight</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">30</span><span class="tok-nx">d</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Height</span> <span class="tok-kr">as</span> <span class="tok-nx">recorded</span> <span class="tok-k">in</span> <span class="tok-nx">local</span> <span class="tok-nx">system</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">height</span>: <span class="tok-kt">Quantity</span>
        <span class="tok-nx">currency</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-nx">y</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Main</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Weight</span> <span class="tok-k">in</span> <span class="tok-nx">kg</span><span class="tok-p">,</span> <span class="tok-nx">converted</span> <span class="tok-kr">as</span> <span class="tok-nx">necessary</span> <span class="tok-nx">from</span> <span class="tok-nx">subject</span> <span class="tok-nx">weight</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">weight_in_kg</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">====================================================</span>
            <span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">units</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;kg&quot;</span><span class="tok-o">:</span>    <span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">magnitude</span><span class="tok-p">,</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">units</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;lb&quot;</span><span class="tok-o">:</span>    <span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">magnitude</span> <span class="tok-o">/</span> <span class="tok-mf">2.2</span><span class="tok-p">,</span>
            <span class="tok-o">----------------------------------------------------</span>
            <span class="tok-o">*:</span>                      <span class="tok-p">{</span><span class="tok-nx">Quantity_converter</span><span class="tok-p">}.</span>
                                    <span class="tok-nx">convert_value</span> <span class="tok-p">(</span><span class="tok-nx">weight</span><span class="tok-p">.</span><span class="tok-nx">value</span><span class="tok-p">,</span>
                                        <span class="tok-nx">from</span>: <span class="tok-kt">weight.units</span><span class="tok-p">,</span>
                                        <span class="tok-nx">to</span><span class="tok-o">:</span> <span class="tok-s2">&quot;kg&quot;</span><span class="tok-p">,</span>
                                        <span class="tok-nx">UCUM</span><span class="tok-p">.[</span><span class="tok-nx">mass</span><span class="tok-p">])</span>
            <span class="tok-o">====================================================</span>
        <span class="tok-p">;</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Height</span> <span class="tok-k">in</span> <span class="tok-nx">m</span><span class="tok-p">,</span> <span class="tok-nx">converted</span> <span class="tok-kr">as</span> <span class="tok-nx">necessary</span> <span class="tok-nx">from</span> <span class="tok-nx">subject</span> <span class="tok-nx">height</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">height_in_m</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">choice</span> <span class="tok-nx">of</span>
            <span class="tok-o">=====================================================</span>
            <span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">units</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;m&quot;</span><span class="tok-o">:</span>     <span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">magnitude</span><span class="tok-p">,</span>
            <span class="tok-o">-----------------------------------------------------</span>
            <span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">units</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;cm&quot;</span><span class="tok-o">:</span>    <span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">magnitude</span> <span class="tok-o">/</span> <span class="tok-mi">100</span><span class="tok-p">,</span>
            <span class="tok-o">-----------------------------------------------------</span>
            <span class="tok-o">*:</span>                      <span class="tok-p">{</span><span class="tok-nx">Quantity_converter</span><span class="tok-p">}.</span>
                                    <span class="tok-nx">convert_value</span> <span class="tok-p">(</span><span class="tok-nx">height</span><span class="tok-p">.</span><span class="tok-nx">value</span><span class="tok-p">,</span>
                                        <span class="tok-nx">from</span>: <span class="tok-kt">height.units</span><span class="tok-p">,</span>
                                        <span class="tok-nx">to</span><span class="tok-o">:</span> <span class="tok-s2">&quot;m&quot;</span><span class="tok-p">,</span>
                                        <span class="tok-nx">UCUM</span><span class="tok-p">.[</span><span class="tok-nx">length</span><span class="tok-p">])</span>
            <span class="tok-o">=====================================================</span>
        <span class="tok-p">;</span>

<span class="tok-nx">rules</span> <span class="tok-o">--</span> <span class="tok-nx">Output</span>

    <span class="tok-o">|</span>
    <span class="tok-o">|</span> <span class="tok-nx">Body</span> <span class="tok-nx">mass</span> <span class="tok-nx">index</span>
    <span class="tok-o">|</span>
    <span class="tok-nx">BMI</span>: <span class="tok-kt">Real</span>
        <span class="tok-nx">Result</span> <span class="tok-o">:=</span> <span class="tok-nx">weight_in_kg</span> <span class="tok-o">/</span> <span class="tok-nx">height_in_m</span> <span class="tok-o">^</span> <span class="tok-mi">2</span>
        <span class="tok-p">;</span>

<span class="tok-nx">definitions</span> <span class="tok-o">--</span> <span class="tok-nx">Terminology</span>

    <span class="tok-nx">terminology</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
        <span class="tok-nx">term_definitions</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;en&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                <span class="tok-s2">&quot;bmi&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body mass index&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;weight&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body weight, in whatever units are in local use&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;height&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body height, in whatever units are in local use&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;weight_in_kg&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body weight in kg&quot;</span>
                <span class="tok-p">},</span>
                <span class="tok-s2">&quot;height_in_m&quot;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Body height in m&quot;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-03-02 14:00:28 UTC
</div>
</div>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/pygments-default.css">
</body>
</html>